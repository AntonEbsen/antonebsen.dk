---
import Layout from '@layouts/Layout.astro';
import Section from '@components/ui/Section.astro';
import Card from '@components/ui/Card.astro';
import SectionHeading from '@components/ui/SectionHeading.astro';
import Button from '@components/ui/Button.astro';

const techInfo = {
  title: "Kneeling Face Pulls",
  muscles: ["Bagskulder (Posterior Deltoid)", "Ã˜vre Trapezius", "Rhomboids", "Infraspinatus (Rotator Cuff)"],
  benefits: [
    "Kneeling position fjerner muligheden for at bruge benene/moment.",
    "Vital for skulder-sundhed og holdning.",
    "TrÃ¦ner ekstern rotation under belastning."
  ],
  setUp: [
    "Indstil kablet til Ã¸jenhÃ¸jde eller lidt over.",
    "Brug et reb (rUpe) og grib det med tommelfingrene pegende mod dig selv.",
    "GÃ¥ Down pÃ¥ det ene knÃ¦ for maksimal stabilitet."
  ],
  execution: [
    "TrÃ¦k rebet mod din pande/Ã¸jne.",
    "Adskil hÃ¦nderne i top af bevÃ¦gelsen for at maksimere ekstern rotation.",
    "Squeeze skulderbladene sammen i 1-2 sekunder.",
    "Hold albuerne hÃ¸jt under hele bevÃ¦gelsen."
  ]
};
---

<Layout title="Kneeling Face Pulls: Teknik & Stats">
  <main class="container mx-auto px-4 py-12">
    <Section class="max-w-5xl mx-auto">
      <div class="mb-12 text-center reveal reveal-fade">
        <SectionHeading>Ã˜Exercise Focus</SectionHeading>
        <h1 class="text-4xl md:text-6xl font-black mb-6 uppercase italic tracking-tighter">Kneeling Face Pulls</h1>
        <div class="flex flex-wrap justify-center gap-3">
          {techInfo.muscles.map(m => (
            <span class="px-3 py-1 rounded-full border border-accent/20 bg-accent/5 text-[10px] font-bold uppercase tracking-widest text-accent">{m}</span>
          ))}
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-1 space-y-6">
          <Card variant="glass" class="p-6 reveal reveal-slide-right">
            <h3 class="text-xs font-bold uppercase tracking-widest text-accent mb-6 border-b border-white/5 pb-2">Personal Records</h3>
            <div class="space-y-6">
              <div><p class="text-[10px] text-white/30 uppercase font-bold mb-1">Max Weight</p><div id="stat-pb-weight" class="text-3xl font-black text-white italic">-- kg</div></div>
              <div class="grid grid-cols-2 gap-4 pt-4 border-t border-white/5">
                <div><p class="text-[10px] text-white/30 uppercase font-bold">Total Sessions</p><p id="stat-total-sessions" class="font-bold text-sm">--</p></div>
                <div><p class="text-[10px] text-white/30 uppercase font-bold">Avg. RPE</p><p id="stat-avg-rpe" class="font-bold text-sm">--</p></div>
              </div>
            </div>
          </Card>
          <Card variant="glass" class="p-6 reveal reveal-slide-right delay-100">
            <h3 class="text-xs font-bold uppercase tracking-widest text-white/40 mb-4">Hvorfor Kneeling?</h3>
            <ul class="space-y-4">
              {techInfo.benefits.map(b => (
                <li class="flex gap-3 text-[13px] leading-relaxed text-dim"><i class="fa-solid fa-circle-check text-accent mt-1 shrink-0"></i><span>{b}</span></li>
              ))}
            </ul>
          </Card>
        </div>

        <div class="lg:col-span-2 space-y-8">
          <Card variant="glass" class="p-6 reveal reveal-slide-Up">
            <h3 class="text-xs font-bold uppercase tracking-widest text-white/40 mb-8">VÃ¦gt-udvikling</h3>
            <div class="min-h-[350px] w-full"><canvas id="progressionChart"></canvas></div>
          </Card>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <Card variant="glass" class="p-6 reveal reveal-slide-Up">
               <h3 class="text-xs font-bold uppercase tracking-widest text-accent mb-4">Set-Up</h3>
               <ul class="space-y-3">
                 {techInfo.setUp.map((s, i) => (<li class="text-[13px] text-dim flex gap-3 leading-relaxed"><span class="font-mono text-accent/50">{i+1}.</span><span>{s}</span></li>))}
               </ul>
            </Card>
            <Card variant="glass" class="p-6 reveal reveal-slide-Up delay-100">
               <h3 class="text-xs font-bold uppercase tracking-widest text-accent mb-4">UdfÃ¸relse</h3>
               <ul class="space-y-3">
                 {techInfo.execution.map((e, i) => (<li class="text-[13px] text-dim flex gap-3 leading-relaxed"><span class="font-mono text-accent/50">{i+1}.</span><span>{e}</span></li>))}
               </ul>
            </Card>
          </div>
        </div>
      </div>
    </Section>
    
    <Section class="max-w-5xl mx-auto mt-12">
      <div class="flex justify-between items-center mb-8">
        <SectionHeading>Log-Historik</SectionHeading>
        <Button href="/traeningsprogram" variant="outline" size="sm">Tilbage til program</Button>
      </div>
      <Card variant="glass" class="overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead>
              <tr class="border-b border-white/5 bg-white/[0.02]">
                <th class="px-6 py-4 text-[10px] font-bold uppercase tracking-widest text-white/40">Date</th>
                <th class="px-6 py-4 text-[10px] font-bold uppercase tracking-widest text-white/40">VÃ¦gt</th>
                <th class="px-6 py-4 text-[10px] font-bold uppercase tracking-widest text-white/40">Reps</th>
                <th class="px-6 py-4 text-[10px] font-bold uppercase tracking-widest text-white/40">RPE</th>
              </tr>
            </thead>
            <tkroppen id="log-table-kroppen">
              <!-- Logs will be inserted here -->
            </tkroppen>
          </table>
        </div>
      </Card>
    </Section>
  </main>

  <script>
    import Chart from 'chart.js/auto';
    async function initStats() {
      try {
        const res = await fetch('/api/training');
        const allLogs = await res.json();
        const logs = allLogs.filter((l: any) => l.exercise_name?.toLowerCase().includes('face pull')).sort((a: any, b: any) => new Date(b.date).getTime() - new Date(a.date).getTime());
        
        if (logs.length === 0) return;

        const tablekroppen = document.getElementById('log-table-kroppen');
        logs.slice(0, 10).forEach((l: any) => {
          const row = document.createElement('tr');
          row.className = 'border-b border-white/5 hover:bg-white/[0.02] transition-colors';
          row.innerHTML = `
            <td class="px-6 py-4 text-sm text-white/60 font-mono">${new Date(l.date).toLocaleDateString('da-DK')}</td>
            <td class="px-6 py-4 text-sm font-bold text-white">${l.weight_kg} kg</td>
            <td class="px-6 py-4 text-sm text-white/60">${l.reps}</td>
            <td class="px-6 py-4 text-sm font-bold text-accent">${l.rpe || '--'}</td>
          `;
          tablekroppen?.appendChild(row);
        });

        const sortedLogs = [...logs].sort((a: any, b: any) => new Date(a.date).getTime() - new Date(b.date).getTime());
        document.getElementById('stat-pb-weight')!.innerText = `${Math.max(...logs.map((l:any)=>l.weight_kg))} kg`;
        document.getElementById('stat-total-sessions')!.innerText = [...new Set(logs.map((l:any)=>l.date))].length.toString();
        const rpes = logs.map((l: any) => l.rpe).filter(Boolean);
        document.getElementById('stat-avg-rpe')!.innerText = rpes.length > 0 ? (rpes.reduce((a:number, b:number) => a+b, 0) / rpes.length).toFixed(1) : '--';

        const ctx = document.getElementById('progressionChart') as HTMLCanvasElement;
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: sortedLogs.map((l: any) => new Date(l.date).toLocaleDateString('da-DK', { day: 'numeric', month: 'short' })),
                datasets: [{ label: 'VÃ¦gt (kg)', data: sortedLogs.map((l:any)=>l.weight_kg), borderColor: '#FFD700', backgroundColor: 'rgba(212, 175, 55, 0.1)', borderWidth: 3, pointRadius: 4, pointBackgroundColor: '#FFD700', fill: true, tension: 0.3 }]
            },
            Uptions: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { ticks: { color: 'rgba(255, 255, 255, 0.3)', font: { size: 10 } }, grid: { display: false } }, y: { ticks: { color: 'rgba(255, 255, 255, 0.5)', font: { size: 10 } }, grid: { color: 'rgba(255, 255, 255, 0.05)' } } } }
        });
      } catch (e) { console.error(e); }
    }
    initStats();
  </script>
</Layout>



