---
import Layout from '@layouts/BaseLayout.astro';
import Pill from '@components/ui/Pill.astro';
import Section from '@components/ui/Section.astro';
import Card from '@components/ui/Card.astro';
import Button from '@components/ui/Button.astro';
import ProjectCard from '@components/portfolio/ProjectCard.astro';
import SectionHeading from '@components/ui/SectionHeading.astro';
import ContactCard from '@components/common/ContactCard.astro';
import DiscoveryGrid from '@components/common/DiscoveryGrid.astro';
import { supabase } from '@lib/supabase';
import { getEntry } from 'astro:content';

export const prerender = true;

interface Props {
  lang: 'da' | 'en' | 'de';
}

const { lang } = Astro.props;
const entry = await getEntry('pages', `${lang}/portfolio`);

if (!entry) {
  throw new Error(`Could not find content for ${lang}/portfolio`);
}

const content: any = entry.data;

// Hardcoded Cases (now called Projects)
const hardcodedProjects = {
  da: [
        {
            id: "case-gfc",
            title: "Global Financial Cycle & spillovers fra US pengepolitik",
            pill: "Empirisk makro",
            desc: "(Bachelorprojekt) Undersøgelse af hvordan amerikansk pengepolitik påvirker globale finansielle forhold.",
            url: "/cases", // Keeping link for now or just info
            tags: ["Empirisk makro", "US Pengepolitik", "SVAR"]
        },
        {
            id: "case-ecb",
            title: "One Rule to Rule Them All? ECB Taylor Rules",
            pill: "Monetær økonomi",
            desc: "(Seminarprojekt) Analyse af asymmetriske effekter af ECB's pengepolitik via Taylor-regler og GMM.",
            tags: ["Monetær økonomi", "Taylor-regler", "GMM"]
        },
        {
            id: "case-rd",
            title: "Valutakursdynamik – Inflation & Relative Kurser",
            pill: "Anvendt Dataanalyse",
            desc: "Eksplorativ analyse af sammenhængen mellem dansk inflation og hovedvalutaer (EUR, USD, CNY).",
            tags: ["Dataanalyse", "Inflation", "DST API"]
        }
  ],
  en: [
        {
            id: "case-gfc",
            title: "Global Financial Cycle & Spillovers from US Monetary Policy",
            pill: "Empirical Macro",
            desc: "(Bachelor's Project) Investigation of how US monetary policy affects global financial conditions.",
            tags: ["Empirical Macro", "US Monetary Policy", "SVAR"]
        },
        {
            id: "case-ecb",
            title: "One Rule to Rule Them All? ECB Taylor Rules",
            pill: "Monetary Economics",
            desc: "(Seminar Paper) Analysis of asymmetric effects of ECB monetary policy via Taylor rules and GMM.",
            tags: ["Monetary Economics", "Taylor Rules", "GMM"]
        },
        {
            id: "case-erd",
            title: "Exchange Rate Dynamics – Inflation & Relative Rates",
            pill: "Applied Data Analysis",
            desc: "Exploratory analysis of the relationship between Danish inflation and major currencies.",
            tags: ["Data Analysis", "Inflation", "DST API"]
        }
  ],
  de: [
        {
            id: "case-gfc",
            title: "Globaler Finanzzyklus & Spillovers der US-Geldpolitik",
            pill: "Empirische Makroökonomik",
            desc: "(Bachelorarbeit) Untersuchung, wie die US-Geldpolitik globale Finanzbedingungen beeinflusst.",
            tags: ["Empirische Makro", "US-Geldpolitik", "SVAR"]
        },
        {
            id: "case-ecb",
            title: "EZB-Taylor-Regeln: One Rule to Rule Them All?",
            pill: "Monetäre Außenwirtschaft",
            desc: "(Seminararbeit) Analyse asymmetrischer Effekte der EZB-Geldpolitik über Taylor-Regeln.",
            tags: ["Geldpolitik", "Taylor-Regeln", "GMM"]
        },
        {
            id: "case-erd",
            title: "Wechselkursdynamik – Inflation & relative Kurse",
            pill: "Angewandte Datenanalyse",
            desc: "Explorative Analyse des Zusammenhangs zwischen dänischer Inflation und Hauptwährungen.",
            tags: ["Datenanalyse", "Inflation", "DST API"]
        }
  ]
};

const featuredProjects = hardcodedProjects[lang] || hardcodedProjects.da;

// Supabase Data Fetching
let supabaseProjects = [];
if (supabase) {
  const { data, error } = await supabase.from('projects').select('*').order('created_at', { ascending: false });
  if (!error && data) supabaseProjects = data;
}

const cvLink = lang === 'en' ? '/en/cv' : lang === 'de' ? '/de/cv' : '/cv';
const projectsLabel = lang === 'da' ? 'Udvalgte Projekter' : lang === 'de' ? 'Ausgewählte Projekte' : 'Featured Projects';
const otherProjectsLabel = lang === 'da' ? 'Andre Projekter' : lang === 'de' ? 'Andere Projekte' : 'Other Projects';
---

<Layout 
  title={content.title}
  description={content.description}
  bodyClass={content.bodyClass}
>

  <style>
    .portfolio-wrap {
      max-width: 1200px;
      margin: 24px auto;
      padding: 0 16px 32px;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1fr);
      gap: 22px;
      align-items: start;
    }

    .projects-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px;
      margin-bottom: 32px;
    }

    @media (max-width: 980px) {
      .hero-grid, .projects-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <main class="portfolio-wrap">
    <!-- HERO -->
      <Section>
        <div class="hero-grid">
          <Card variant="glass" class="p-8">
            <p class="text-xs font-extrabold uppercase tracking-widest text-dim mb-3">{content.hero.eyebrow}</p>
            <h1 class="text-4xl leading-[1.15] mb-5 font-bold">{content.hero.title}</h1>
            <p class="text-[17px] leading-relaxed text-dim mb-6 opacity-90">
              {content.hero.text}
            </p>
    
            <div class="flex flex-wrap gap-3 mb-6">
              <Button href={cvLink}>{content.hero.cta.cv}</Button>
              <Button href="https://github.com/AntonEbsen" target="_blank" rel="noopener" variant="ghost"><i class="fa-brands fa-github mr-2"></i> {content.hero.cta.github}</Button>
              <Button href="https://www.linkedin.com/in/antonebsen/" target="_blank" rel="noopener" variant="ghost"><i class="fa-brands fa-linkedin mr-2"></i> {content.hero.cta.linkedin}</Button>
            </div>
    
            <div class="flex flex-wrap gap-2">
               {content.hero.pills.map((pill: string) => (
                 <Pill variant="accent">{pill}</Pill>
               ))}
            </div>
          </Card>
    
          <div class="hidden md:block">
            <Card variant="glass" class="p-6">
              <SectionHeading>{content.sidebar.title}</SectionHeading>
              <ul class="list-none p-0 m-0 space-y-2 text-sm text-dim opacity-90">
                {content.sidebar.items.map((item: string) => (
                    <li class="relative pl-4 before:content-['-'] before:absolute before:left-0 before:text-accent">{item}</li>
                ))}
              </ul>
            </Card>
          </div>
        </div>
      </Section>
  
      <!-- FEATURED PROJECTS (Hardcoded cases) -->
      <Section>
        <SectionHeading>{projectsLabel}</SectionHeading>
        <div class="projects-grid">
          {featuredProjects.map((p) => (
            <ProjectCard
              title={p.title}
              tagString={p.tags.join(' · ')}
              description={p.desc}
              tools={[]}
              output={content.ui.featured}
              links={p.url ? [{ text: content.ui.viewProject, url: p.url, icon: 'arrow-right' }] : []}
              lang={lang}
            />
          ))}
        </div>
      </Section>

      <!-- OTHER PROJECTS (Supabase) -->
      <Section>
        <SectionHeading>{otherProjectsLabel}</SectionHeading>
        <div class="projects-grid">
          {supabaseProjects?.map((p: any) => (
            <ProjectCard
              title={p.title}
              tagString={p.tags ? p.tags.join(' · ') : ''}
              description={p.description}
              tools={[]}
              output={content.ui.project}
              links={p.url ? [{ text: content.ui.viewProject, url: p.url, icon: 'arrow-right' }] : []}
              lang={lang}
            />
          ))}
        </div>
      </Section>
  
      <!-- DISCOVERY (Cleaned) -->
      <Section id="discovery">
        <DiscoveryGrid 
          title={lang === 'da' ? 'Ressourcer' : lang === 'de' ? 'Ressourcen' : 'Resources'}
          items={[
            { 
                label: lang === 'da' ? 'Downloads' : lang === 'de' ? 'Downloads' : 'Resources', 
                url: lang === 'da' ? '/resources' : lang === 'de' ? '/de/resources' : '/en/resources', 
                icon: 'fa-download', 
                description: lang === 'da' ? 'Templates og værktøjer' : lang === 'de' ? 'Vorlagen und Tools' : "Templates and tools"
            },
            { 
                label: lang === 'da' ? 'GitHub' : 'GitHub', 
                url: 'https://github.com/AntonEbsen', 
                icon: 'fa-brands fa-github', 
                description: lang === 'da' ? 'Se min kildekode' : lang === 'de' ? 'Meinen Quellcode ansehen' : "View my source code"
            },
            { 
                label: lang === 'da' ? 'Milepæle' : lang === 'de' ? 'Meilensteine' : 'Milestones', 
                url: lang === 'da' ? '/timeline' : lang === 'de' ? '/de/timeline' : '/en/timeline', 
                icon: 'fa-timeline', 
                description: lang === 'da' ? 'Min faglige rejse' : lang === 'de' ? 'Meine berufliche Reise' : "My professional journey"
            }
          ]}
        />
      </Section>
  
      <!-- Footer card -->
      <Section>
        <ContactCard />
      </Section>
  
  </main>
</Layout>



