---
import Navbar from '@components/Navbar.astro';
import Footer from '@components/Footer.astro';
import SEO from '@components/SEO.astro';
import ChatWidget from '@components/common/ChatWidget.astro';
import CommandPalette from '@components/common/CommandPalette.astro';
import '@styles/styles.css';
import '@styles/themes.css';
// import '@fontsource-variable/inter'; // Causing build issues
---

<!DOCTYPE html>
<html lang={lang}>
<head>
  <SEO title={title} description={description} image={image} article={article} />
  <meta name="design-version" content="dark-gold-v1" />
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
	title: string;
	description?: string;
	image?: string;
  article?: boolean;
	bodyClass?: string;
}

import { getLangFromUrl } from '@i18n/utils';

const { title, description, image, article, bodyClass = "" } = Astro.props;
const lang = getLangFromUrl(Astro.url);
---

<!DOCTYPE html>
<html lang={lang}>
<head>
  <SEO title={title} description={description} image={image} article={article} />
  <meta name="design-version" content="dark-gold-v1" />
  <!-- <title>{title}</title> -->

  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <!-- Scripts -->
  <script src="/assets/js/search.js" defer></script>
  <script src="/assets/js/themes.js" defer></script>

  <slot name="head" />
</head>
<body class={bodyClass}>
  <Navbar />

  <slot />

  <Footer />
  
  <ChatWidget />
  <CommandPalette />

  <script>
    // Premium reveal observer
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
          // Optionally unobserve after revealing
          // revealObserver.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));
    });

    // Handle dynamic content (like search results or filtered CV items)
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
          if (node instanceof HTMLElement && node.classList.contains('reveal')) {
            revealObserver.observe(node);
          }
          if (node instanceof HTMLElement) {
             node.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));
          }
        });
      });
    });

    observer.observe(document.body, { childList: true, subtree: true });
  </script>
</body>
</html>
