---
import Card from '@components/ui/Card.astro';
import Pill from '@components/ui/Pill.astro';
import Button from '@components/ui/Button.astro';

interface Props {
  title: string;
  tag: string;
  institution: string;
  description: string;
  grade?: string;
  syllabus?: string[];
  verifiedSkills?: string[];
  relatedProjects?: { title: string; href: string }[];
  links?: { text: string; href: string; type?: string; icon?: string }[];
}

const { title, tag, institution, description, grade, syllabus, verifiedSkills, relatedProjects, links } = Astro.props;

// Helper for resource icon
const getIcon = (type?: string, defaultIcon?: string) => {
    if (type === 'note') return 'fa-book';
    if (type === 'code') return 'fa-code';
    if (type === 'project') return 'fa-file-lines';
    return defaultIcon || 'fa-arrow-right';
};
---

<div class="course-card-wrapper h-full group">
    <details class="group/details h-full">
        <summary class="list-none cursor-pointer h-full">
            <Card variant="glass" class="p-5 h-full flex flex-col hover:border-accent/30 transition-colors relative overflow-hidden">
                {/* Grade Badge - Absolute Position */}
                {grade && (
                    <div class="absolute top-0 right-0 bg-white/5 border-l border-b border-white/10 rounded-bl-xl px-3 py-1.5 backdrop-blur-md">
                        <span class="text-[10px] uppercase text-dim tracking-wider mr-1">Grade</span>
                        <span class="text-xs font-bold text-accent">{grade}</span>
                    </div>
                )}

                <div class="flex justify-between items-start mb-2 gap-2 pr-16">
                    <div>
                        <Pill variant="accent" class="mb-2">{tag}</Pill>
                        <h3 class="font-bold text-lg leading-tight text-white mb-1 group-hover/details:text-accent transition-colors">{title}</h3>
                        <p class="text-xs text-dim font-mono">{institution}</p>
                    </div>
                </div>

                <p class="text-sm text-dim/90 leading-relaxed mb-4 flex-grow">
                    {description}
                </p>

                {/* Footer / CTA to expand */}
                <div class="mt-auto pt-4 border-t border-white/5 flex justify-between items-center">
                    <span class="text-xs font-bold text-dim group-hover/details:text-white transition-colors">
                        View Details
                    </span>
                    <i class="fa-solid fa-chevron-down text-dim text-xs transition-transform group-open/details:rotate-180"></i>
                </div>
            </Card>
        </summary>
        
        {/* Expanded Content */}
        <div class="mt-2 pl-4 pr-2 py-2 border-l-2 border-accent/20 animate-fade-in">
            {/* Syllabus */}
            {syllabus && syllabus.length > 0 && (
                <div class="mb-4">
                    <h4 class="text-xs uppercase tracking-wider text-dim mb-2 font-bold">Syllabus</h4>
                    <ul class="text-sm text-dim space-y-1">
                        {syllabus.map(item => (
                            <li class="flex items-center gap-2">
                                <i class="fa-solid fa-check text-accent/50 text-[10px]"></i>
                                {item}
                            </li>
                        ))}
                    </ul>
                </div>
            )}

            {/* Verified Skills */}
            {verifiedSkills && verifiedSkills.length > 0 && (
                 <div class="mb-4">
                    <h4 class="text-xs uppercase tracking-wider text-dim mb-2 font-bold">Verified Skills</h4>
                    <div class="flex flex-wrap gap-2">
                        {verifiedSkills.map(skill => (
                            <div class="px-2 py-1 rounded bg-green-500/10 border border-green-500/20 text-xs text-green-200 flex items-center gap-1.5">
                                <i class="fa-solid fa-circle-check text-[10px]"></i>
                                {skill}
                            </div>
                        ))}
                    </div>
                 </div>
            )}

            {/* Related Projects */}
            {relatedProjects && relatedProjects.length > 0 && (
                 <div class="mb-4">
                    <h4 class="text-xs uppercase tracking-wider text-dim mb-2 font-bold">Applied In</h4>
                    <div class="flex flex-col gap-1">
                        {relatedProjects.map(proj => (
                            <a href={proj.href} class="text-xs text-accent hover:underline flex items-center gap-1.5">
                                <i class="fa-solid fa-arrow-right text-[10px]"></i>
                                {proj.title}
                            </a>
                        ))}
                    </div>
                 </div>
            )}

             {/* Resources / Links */}
             {links && links.length > 0 && (
                <div class="mt-4 pt-3 border-t border-white/5">
                    <h4 class="text-xs uppercase tracking-wider text-dim mb-3 font-bold">Resources</h4>
                    <div class="flex flex-wrap gap-2">
                        {links.map(link => (
                            <Button href={link.href} variant="ghost" class="text-xs py-1.5 h-auto">
                                <i class={`fa-solid ${getIcon(link.type, link.icon)} mr-1.5`}></i>
                                {link.text}
                            </Button>
                        ))}
                    </div>
                </div>
            )}
        </div>
    </details>
</div>

<style>
    /* Turn off default marker for summary */
    summary::-webkit-details-marker {
        display: none;
    }
</style>
