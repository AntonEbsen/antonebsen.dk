---
import Layout from '../layouts/Layout.astro';
import Section from '@components/ui/Section.astro';
import Card from '@components/ui/Card.astro';
import Button from '@components/ui/Button.astro';
import Pill from '@components/ui/Pill.astro';
import SectionHeading from '@components/ui/SectionHeading.astro';
import ContactCard from '@components/common/ContactCard.astro';
import { createClient } from '@supabase/supabase-js';

export const prerender = false;

const supabase = createClient(import.meta.env.SUPABASE_URL, import.meta.env.SUPABASE_ANON_KEY);
let { data: certifications, error } = await supabase
  .from('certifications')
  .select('*')
  .eq('visible', true)
  .order('id', { ascending: false });

if (error) certifications = [];

const pythonCerts = certifications?.filter(c => c.category === 'Python') || [];
const matlabCerts = certifications?.filter(c => c.category === 'MATLAB') || [];
const sasCerts = certifications?.filter(c => c.category === 'SAS') || [];
const writingCerts = certifications?.filter(c => c.category === 'Formidling') || [];
const otherCerts = certifications?.filter(c => !['Python', 'MATLAB', 'SAS', 'Formidling'].includes(c.category)) || [];
---

<Layout 
  title="Anton Meier Ebsen Jørgensen – Certificeringer" 
  description="Certificeringer i Python, MATLAB, SAS m.m."
  bodyClass="cert-page"
>
  <style>
    .cert-wrap {
      max-width: 1200px;
      margin: 24px auto;
      padding: 0 16px 32px;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1fr);
      gap: 22px;
      align-items: start;
    }

    .certs-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 14px;
      margin-top: 12px;
    }

    @media (max-width: 980px) {
      .hero-grid, .certs-grid { 
        grid-template-columns: 1fr; 
      }
    }
  </style>

  <main class="cert-wrap">

    <!-- HERO -->
    <Section>
      <div class="hero-grid">
        <Card variant="glass" class="p-8">
          <p class="text-xs font-bold uppercase tracking-widest text-dim mb-3">Certificeringer</p>
          <h1 class="text-4xl font-bold leading-tight mb-4">Kurser, badges og dokumentation</h1>
          <p class="text-lg text-dim mb-6">
            Samlet oversigt over mine certificeringer inden for programmering, dataanalyse og formidling.
            Jeg linker til beviser når muligt.
          </p>

          <div class="flex flex-wrap gap-3 mb-6">
            <Button href="#cat-python">Python</Button>
            <Button href="#cat-matlab">MATLAB</Button>
            <Button href="#cat-sas">SAS</Button>
            <Button href="#cat-writing">Skriveakademi</Button>
          </div>

          <div class="flex flex-wrap gap-2" aria-label="Temaer">
            <Pill variant="accent">Data</Pill>
            <Pill variant="accent">Coding</Pill>
            <Pill variant="accent">Økonomi</Pill>
            <Pill variant="accent">Formidling</Pill>
          </div>
        </Card>

        <div class="hidden md:block">
          <Card variant="glass" class="p-6">
            <SectionHeading>Tip</SectionHeading>
            <p class="text-sm text-dim leading-relaxed">
              Når du tilføjer nye certs: hold titler ensartede og skriv 1 linje om “hvad kan jeg nu”.
              Det er 10/10 mere værd end “jeg har taget et kursus”.
            </p>
          </Card>
        </div>
      </div>
    </Section>

    {certifications?.length === 0 && (
        <Section>
            <Card variant="glass" class="p-8 text-center text-dim bg-purple-500/10 border-purple-500/20">
                <p>Ingen certificeringer fundet endnu. <br/>Tilføj dine diplomer i <a href="/dashboard" class="text-white underline">Dashboardet</a>.</p>
            </Card>
        </Section>
    )}

    <!-- PYTHON -->
    <Section id="cat-python" aria-label="Python certificeringer">
      <Card variant="bordered" class="p-6">
        <SectionHeading>Python</SectionHeading>
        <p class="text-dim opacity-70 mb-6 text-sm">Dataanalyse, workflows, og praktisk programmering.</p>

        <div class="certs-grid">
          {pythonCerts.map(c => (
             <Card variant="glass" class="p-4 flex flex-col h-full">
                <div class="flex justify-between items-start mb-2 gap-2">
                  <h3 class="font-bold text-base leading-tight">{c.name}</h3>
                  <Pill variant="accent">Python</Pill>
                </div>
                <p class="text-xs text-dim mb-2">{c.issuer} · {c.year}</p>
                <p class="text-sm text-dim opacity-80 mb-4 flex-grow">{c.description}</p>
                <div class="flex flex-wrap gap-2 mt-auto">
                  {c.url && <Button href={c.url} target="_blank" size="sm" variant="ghost"><i class="fa-solid fa-arrow-up-right-from-square mr-2"></i> Bevis</Button>}
                </div>
              </Card>
          ))}
          {pythonCerts.length === 0 && <p class="text-dim text-sm italic">Ingen Python certificeringer endnu.</p>}
        </div>
      </Card>
    </Section>

    <!-- MATLAB -->
    <Section id="cat-matlab" aria-label="MATLAB certificeringer">
      <Card variant="bordered" class="p-6">
         <SectionHeading>MATLAB</SectionHeading>
         <p class="text-dim opacity-70 mb-6 text-sm">Numerisk analyse, matrixregning og workflows.</p>

        <div class="certs-grid">
           {matlabCerts.map(c => (
             <Card variant="glass" class="p-4 flex flex-col h-full">
                <div class="flex justify-between items-start mb-2 gap-2">
                  <h3 class="font-bold text-base leading-tight">{c.name}</h3>
                  <Pill variant="accent">MATLAB</Pill>
                </div>
                <p class="text-xs text-dim mb-2">{c.issuer} · {c.year}</p>
                <p class="text-sm text-dim opacity-80 mb-4 flex-grow">{c.description}</p>
                <div class="flex flex-wrap gap-2 mt-auto">
                  {c.url && <Button href={c.url} target="_blank" size="sm" variant="ghost">Bevis</Button>}
                </div>
              </Card>
          ))}
          {matlabCerts.length === 0 && <p class="text-dim text-sm italic">Ingen MATLAB certificeringer endnu.</p>}
        </div>
      </Card>
    </Section>

    <!-- SAS -->
    <Section id="cat-sas" aria-label="SAS certificeringer">
      <Card variant="bordered" class="p-6">
        <SectionHeading>SAS</SectionHeading>
        <p class="text-dim opacity-70 mb-6 text-sm">Tidsrækker, data management og analyse.</p>

        <div class="certs-grid">
           {sasCerts.map(c => (
             <Card variant="glass" class="p-4 flex flex-col h-full">
                <div class="flex justify-between items-start mb-2 gap-2">
                  <h3 class="font-bold text-base leading-tight">{c.name}</h3>
                  <Pill variant="accent">SAS</Pill>
                </div>
                <p class="text-xs text-dim mb-2">{c.issuer} · {c.year}</p>
                <p class="text-sm text-dim opacity-80 mb-4 flex-grow">{c.description}</p>
                <div class="flex flex-wrap gap-2 mt-auto">
                  {c.url && <Button href={c.url} target="_blank" size="sm" variant="ghost">Bevis</Button>}
                </div>
              </Card>
          ))}
          {sasCerts.length === 0 && <p class="text-dim text-sm italic">Ingen SAS certificeringer endnu.</p>}
        </div>
      </Card>
    </Section>

    <!-- WRITING -->
    <Section id="cat-writing" aria-label="Skriveakademi">
      <Card variant="bordered" class="p-6">
        <SectionHeading>Politikens Skriveakademi</SectionHeading>
        <p class="text-dim opacity-70 mb-6 text-sm">Skrivning, struktur og formidling.</p>

        <div class="certs-grid">
           {writingCerts.map(c => (
             <Card variant="glass" class="p-4 flex flex-col h-full">
                <div class="flex justify-between items-start mb-2 gap-2">
                  <h3 class="font-bold text-base leading-tight">{c.name}</h3>
                  <Pill variant="accent">Formidling</Pill>
                </div>
                <p class="text-xs text-dim mb-2">{c.issuer} · {c.year}</p>
                <p class="text-sm text-dim opacity-80 mb-4 flex-grow">{c.description}</p>
                <div class="flex flex-wrap gap-2 mt-auto">
                  {c.url && <Button href={c.url} target="_blank" size="sm" variant="ghost">Bevis</Button>}
                </div>
              </Card>
          ))}
          {writingCerts.length === 0 && <p class="text-dim text-sm italic">Ingen Formidlings-certificeringer endnu.</p>}
        </div>
      </Card>
    </Section>

    {otherCerts.length > 0 && (
        <Section id="cat-other">
          <Card variant="bordered" class="p-6">
            <SectionHeading>Andet</SectionHeading>
            <div class="certs-grid">
              {otherCerts.map(c => (
                 <Card variant="glass" class="p-4 flex flex-col h-full">
                    <div class="flex justify-between items-start mb-2 gap-2">
                      <h3 class="font-bold text-base leading-tight">{c.name}</h3>
                      <Pill variant="accent">{c.category}</Pill>
                    </div>
                    <p class="text-xs text-dim mb-2">{c.issuer} · {c.year}</p>
                    <p class="text-sm text-dim opacity-80 mb-4 flex-grow">{c.description}</p>
                    <div class="flex flex-wrap gap-2 mt-auto">
                      {c.url && <Button href={c.url} target="_blank" size="sm" variant="ghost">Bevis</Button>}
                    </div>
                  </Card>
              ))}
            </div>
          </Card>
        </Section>
    )}

    <!-- CTA -->
    <Section>
        <ContactCard 
            title="Vil du se CV’et samlet?"
            text="Certificeringer er “bilag”. CV’et er “historien”. Begge dele har sin plads."
            action="cv"
        />
    </Section>

  </main>
</Layout>
