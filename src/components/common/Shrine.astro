---
---

<!-- 
    THE HIDDEN SHRINE âœï¸
    Ad Majorem Dei Gloriam.
-->

<div id="shrine-overlay" style="display: none;" class="fixed inset-0 z-[100] opacity-0 transition-opacity duration-1000 bg-gradient-to-b from-[#0a0a2a] via-[#1a1a4a] to-black flex-col items-center justify-center font-serif text-center select-none overflow-hidden backdrop-blur-sm">
    
    <!-- Background Texture (Subtle Noise) -->
    <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: url('https://www.transparenttextures.com/patterns/stardust.png');"></div>

    <!-- Incense Smoke Effect ðŸŒ«ï¸ -->
    <div class="absolute inset-0 z-0 pointer-events-none overflow-hidden opacity-30">
         <div class="absolute -bottom-20 left-1/4 w-96 h-96 bg-gray-500/20 rounded-full blur-[80px] animate-smoke-rise"></div>
         <div class="absolute -bottom-32 right-1/4 w-[500px] h-[500px] bg-gray-400/10 rounded-full blur-[100px] animate-smoke-rise-slow"></div>
         <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-64 h-64 bg-gold-500/5 rounded-full blur-[60px] animate-pulse-slow"></div>
    </div>

    <!-- Close Button (Subtle) -->
    <button id="close-shrine" class="absolute top-8 right-8 text-gold-500/50 hover:text-gold-400 transition-colors text-2xl" aria-label="Close">
        <i class="fa-solid fa-times"></i>
    </button>

    <div class="relative z-10 p-8 max-w-2xl mx-auto flex flex-col items-center">
        
        <!-- AUDIO PLAYER -->
        <audio id="shrine-audio" loop preload="auto">
            <source src="/assets/audio/chant.mp3" type="audio/mpeg">
        </audio>

        <!-- SOUND CONTROL -->
        <button id="mute-btn" class="absolute top-8 left-8 text-gold-500/50 hover:text-gold-400 transition-colors text-xl flex items-center gap-2 group" aria-label="Mute/Play">
            <i class="fa-solid fa-volume-high group-hover:block hidden"></i>
            <i class="fa-solid fa-volume-xmark group-hover:hidden block"></i>
            <i class="fa-solid fa-play hidden text-gold-500"></i> <!-- Fallback Play Icon -->
            <span class="text-[10px] uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity">Chant</span>
        </button>
        
        <!-- HEADER: Latin Invocation -->
        <p class="text-gold-500/60 text-sm tracking-[0.3em] uppercase mb-8 animate-fade-in-up" style="animation-delay: 0.5s;">
            In Nomine Patris, et Filii, et Spiritus Sancti
        </p>

        <!-- CENTERPIECE: The Cross -->
        <div class="relative mb-12 animate-fade-in-up" style="animation-delay: 1s;">
            <!-- Halo Glow -->
            <div class="absolute inset-0 bg-gold-500/20 blur-[60px] rounded-full transform scale-150 animate-pulse-slow"></div>
            
            <!-- Crucifix SVG -->
            <div class="relative drop-shadow-[0_0_15px_rgba(255,215,0,0.5)]">
                <svg width="120" height="150" viewBox="0 0 24 30" xmlns="http://www.w3.org/2000/svg" class="mx-auto overflow-visible">
                    <defs>
                        <linearGradient id="gold-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#FDB931;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#B8860B;stop-opacity:1" />
                        </linearGradient>
                         <filter id="glow">
                            <feGaussianBlur stdDeviation="0.5" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    
                    <!-- The Cross -->
                    <path d="M10 2 H14 V6 H22 V10 H14 V28 H10 V10 H2 V6 H10 V2 Z" fill="url(#gold-gradient)" opacity="0.8" />
                    
                    <!-- The Corpus (Body of Christ) -->
                    <!-- Head (Halo) -->
                    <circle cx="12" cy="7.5" r="1.5" fill="url(#gold-gradient)" />
                    <!-- Body & Arms (Stylized) -->
                    <path d="M12 9 C 9 9, 4 8, 4 7 C 4 9, 9 11, 12 12 C 15 11, 20 9, 20 7 C 20 8, 15 9, 12 9 Z M 12 12 L 12 22 L 11 26 L 13 26 L 12 22 Z" fill="url(#gold-gradient)" filter="url(#glow)" />
                    
                    <!-- INRI Sign -->
                    <rect x="11" y="0.5" width="2" height="1.5" fill="url(#gold-gradient)" />
                </svg>
            </div>
        </div>

        <!-- MAIN VERSE -->
        <h1 class="text-3xl md:text-5xl text-transparent bg-clip-text bg-gradient-to-b from-gray-100 to-gray-400 font-serif font-bold italic mb-4 leading-tight animate-fade-in-up" style="animation-delay: 2s;">
            "Ego sum via et veritas et vita."
        </h1>
        
        <p class="text-gold-400/80 text-lg mb-12 animate-fade-in-up" style="animation-delay: 2.5s;">
            I am the way and the truth and the life.
            <span class="block text-xs mt-2 text-gray-500 uppercase tracking-widest not-italic sans-serif">â€” John 14:6</span>
        </p>

        <!-- INTERACTIVE: Votive Candle -->
        <div class="animate-fade-in-up group cursor-pointer" id="candle-trigger" style="animation-delay: 3.5s;">
            <div class="relative w-8 h-12 mx-auto">
                <!-- Candle Body -->
                <div class="absolute bottom-0 w-8 h-8 bg-red-900/40 border border-red-500/30 rounded-sm"></div>
                <!-- Flame (Hidden initially) -->
                <div id="flame" class="absolute -top-4 left-1/2 -translate-x-1/2 w-4 h-6 bg-orange-400 rounded-full blur-[2px] opacity-0 transition-all duration-700 animate-flicker transform scale-0 group-hover:opacity-50"></div>
            </div>
            <p class="text-xs text-gray-600 mt-4 tracking-widest group-hover:text-gold-500 transition-colors uppercase">
                Light a Candle
            </p>
        </div>

    </div>

    <!-- FOOTER: Dedication -->
    <div class="absolute bottom-8 w-full text-center">
        <p class="text-[10px] text-gray-700 uppercase tracking-[0.2em] opacity-0 animate-fade-in" style="animation-delay: 5s;">
            Ad Majorem Dei Gloriam
        </p>
    </div>

</div>

<style>
    /* Custom Animations for the Shrine */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in-up {
        animation: fadeInUp 1.5s ease-out forwards;
        opacity: 0;
    }

    .animate-fade-in {
        animation: fadeInUp 2s ease-out forwards;
    }

    .animate-pulse-slow {
        animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes flicker {
        0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.8; }
        50% { transform: translateX(-50%) scale(1.1); opacity: 1; filter: brightness(1.2); }
        25% { transform: translateX(-52%) scale(0.9); opacity: 0.7; }
        75% { transform: translateX(-48%) scale(1.05); opacity: 0.9; }
    }

    .animate-flicker {
        animation: flicker 0.1s infinite alternate; /* Fast flicker like real fire */
    }
    
    @keyframes smokeRise {
        0% { transform: translateY(0) scale(1); opacity: 0.5; }
        50% { transform: translateY(-50px) scale(1.1); opacity: 0.3; }
        100% { transform: translateY(-100px) scale(1.2); opacity: 0; }
    }
    
    .animate-smoke-rise {
        animation: smokeRise 8s infinite ease-in-out;
    }
    
    .animate-smoke-rise-slow {
        animation: smokeRise 12s infinite ease-in-out reverse; /* Reverse for variation? Or just longer */
    }

    /* Override Utility for Gradient Text on Icon */
    .text-gradient-gold {
        background: linear-gradient(to bottom, #FFD700, #B8860B);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Lit state */
    .candle-lit #flame {
        opacity: 1 !important;
        transform: translateX(-50%) scale(1);
    }
</style>

<script>
    // Shrine Elements
    const shrine = document.getElementById('shrine-overlay');
    const closeBtn = document.getElementById('close-shrine');
    const candleTrigger = document.getElementById('candle-trigger');
    const flame = document.getElementById('flame');

    // Audio Elements
    const audio = document.getElementById('shrine-audio') as HTMLAudioElement;
    const muteBtn = document.getElementById('mute-btn');
    const volIcon = muteBtn?.querySelector('.fa-volume-high');
    const muteIcon = muteBtn?.querySelector('.fa-volume-xmark');
    const playIcon = muteBtn?.querySelector('.fa-play');

    // Shrine Open/Close Logic
    // Exposed to window for direct calling (preserves user gesture for audio)
    window.openShrine = async () => {
        if (!shrine) return;
        shrine.style.display = 'flex'; // Enable Flexbox layout
        
        // Timeout to allow browser to register display:flex before running opacity transition
        requestAnimationFrame(() => {
            shrine.classList.remove('opacity-0');
        });
        
        // Start Audio
        audio.currentTime = 0;
        audio.volume = 1.0; // Max volume
        audio.muted = false;
        
        try {
            await audio.play();
            console.log("Audio started successfully.");
            // Success: Show Volume Icon
            volIcon?.classList.remove('hidden');
            muteIcon?.classList.add('hidden');
            playIcon?.classList.add('hidden');
        } catch (e) {
            console.error("Audio playback failed (Autoplay blocked?):", e);
            // Fallback: Show Play Icon and Pulse
            volIcon?.classList.add('hidden');
            muteIcon?.classList.add('hidden');
            playIcon?.classList.remove('hidden');
            muteBtn?.classList.add('animate-pulse'); // Draw attention
        }
    };
    
    // Support Custom Event as fallback/alias
    document.addEventListener('openShrine', window.openShrine);

    function closeShrineFn() {
        if (!shrine) return;
        shrine.classList.add('opacity-0');
        
        // Fade Out Audio
        const fadeOut = setInterval(() => {
            if (audio.volume > 0.01) audio.volume -= 0.01;
            else {
                clearInterval(fadeOut);
                audio.pause();
            }
        }, 50);

        setTimeout(() => {
            shrine.style.display = 'none';
        }, 1000);
    }

    closeBtn?.addEventListener('click', closeShrineFn);
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !shrine?.classList.contains('hidden')) {
            closeShrineFn();
        }
    });

    // Mute Logic / Play Fallback
    muteBtn?.addEventListener('click', async () => {
       if (audio.paused) {
           // Fallback: User manually starts audio
           try {
               await audio.play();
               // Reset icons to Playing state (Volume Up)
               volIcon?.classList.remove('hidden');
               muteIcon?.classList.add('hidden');
               playIcon?.classList.add('hidden');
               muteBtn.classList.remove('animate-pulse'); // Stop attention seeker
           } catch (e) {
               console.error("Manual play failed:", e);
           }
       } else {
           // Normal Mute Toggle
           if (audio.muted) {
               audio.muted = false;
               volIcon?.classList.remove('hidden');
               muteIcon?.classList.add('hidden');
           } else {
               audio.muted = true;
               volIcon?.classList.add('hidden');
               muteIcon?.classList.remove('hidden');
           }
       }
    });
    
    // Init state for icons (reversed in HTML for initial hover effect logic, fixing here)
    // Actually, let's keep it simple: Show Volume UP by default. 
    // If clicked -> Mute.
    volIcon?.classList.remove('hidden');
    muteIcon?.classList.add('hidden');


    // Candle Logic (Existing)
    let isLit = false;
    candleTrigger?.addEventListener('click', () => {
        if (!isLit) {
            candleTrigger.classList.add('candle-lit');
            shrine!.style.boxShadow = "inset 0 0 100px rgba(255, 165, 0, 0.1)";
            isLit = true;
        } else {
            candleTrigger.classList.remove('candle-lit');
             shrine!.style.boxShadow = "none";
            isLit = false;
        }
    });
</script>
