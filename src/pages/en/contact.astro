---
import Layout from '../../layouts/Layout.astro';
import Section from '../../components/ui/Section.astro';
import Card from '../../components/ui/Card.astro';
import Button from '../../components/ui/Button.astro';
---

<Layout 
  title="Contact | Anton Ebsen" 
  description="Contact form for Anton Ebsen."
>
  <style>
    .contact-wrap {
        max-width: 800px;
        margin: 40px auto;
        padding: 0 16px;
    }
  </style>

  <main class="contact-wrap">
     <Section>
        <Card variant="glass" class="p-8 md:p-12">
            <h1 class="text-4xl font-bold mb-6 text-center">Contact</h1>
            <p class="text-dim text-center mb-8 text-lg">
                Do you have a question, an idea for a project, or just want to say hello? <br/>
                Fill out the form below, and the message will land directly in my system.
            </p>

            <form id="contact-form" class="space-y-6 max-w-lg mx-auto">
                <div>
                    <label class="block text-accent text-xs font-bold uppercase tracking-wider mb-2">Name</label>
                    <input type="text" id="c-name" name="name" required class="w-full bg-black/50 border border-white/10 p-3 rounded text-white focus:border-accent focus:outline-none transition-colors" placeholder="Your name" />
                </div>
                
                <div>
                    <label class="block text-accent text-xs font-bold uppercase tracking-wider mb-2">Email</label>
                    <input type="email" id="c-email" name="email" required class="w-full bg-black/50 border border-white/10 p-3 rounded text-white focus:border-accent focus:outline-none transition-colors" placeholder="your@email.com" />
                </div>

                <div>
                    <label class="block text-accent text-xs font-bold uppercase tracking-wider mb-2">Message</label>
                    <textarea id="c-message" name="message" required rows="5" class="w-full bg-black/50 border border-white/10 p-3 rounded text-white focus:border-accent focus:outline-none transition-colors" placeholder="What is on your mind?"></textarea>
                </div>

                <div id="form-status" class="hidden p-4 rounded bg-accent/20 text-accent text-center text-sm mb-4">
                    Thanks for your message! I will get back to you as soon as possible.
                </div>

                <Button type="submit" size="lg" icon="paper-plane" class="w-full justify-center">Send Message</Button>
            </form>
        </Card>
     </Section>
  </main>
</Layout>

<script>
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const status = document.getElementById('form-status')!;

    form?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        try {
            const res = await fetch('/api/contact', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                form.reset();
                status.classList.remove('hidden');
                setTimeout(() => status.classList.add('hidden'), 5000);
            } else {
                alert('An error occurred. Please try again later.');
            }
        } catch (err) {
            console.error(err);
            alert('Could not connect to the server.');
        }
    });
</script>
