---
import Layout from '@layouts/Layout.astro';
import Section from '@components/ui/Section.astro';
import Card from '@components/ui/Card.astro';
import SectionHeading from '@components/ui/SectionHeading.astro';
import Button from '@components/ui/Button.astro';

const techInfo = {
  title: "Hanging Leg Raises",
  muscles: ["Rectus Abdominis (Nedre del)", "Obliques", "Hoftebøjere"],
  benefits: [
    "Ekstremt udfordrende for den nedre del af maven.",
    "Forbedrer din grebstyrke og skulder-stabilitet.",
    "Giver et stort bevægeudslag (ROM) for hele coren."
  ],
  setup: [
    "Hæng i en pull-up bar med et overhåndsgreb.",
    "Aktiver dine lats og skuldre (active hang) for at undgå sving.",
    "Hold dine ben samlet."
  ],
  execution: [
    "Løft benene kontrolleret op foran dig.",
    "Tænk på at rulle din hofte mod dit bryst, snarere end blot at løfte benene.",
    "Sænk dem langsomt tilbage uden at miste spændingen i maven.",
    "Tip: Bøj knæene en smule hvis vægten er for tung."
  ]
};
---

<Layout title="Hanging Leg Raises: Teknik & Stats">
  <main class="container mx-auto px-4 py-12">
    <Section class="max-w-5xl mx-auto">
      <div class="mb-12 text-center reveal reveal-fade">
        <SectionHeading>Øvelses-Fokus</SectionHeading>
        <h1 class="text-4xl md:text-6xl font-black mb-6 uppercase italic tracking-tighter italic">Leg Raises</h1>
        <div class="flex flex-wrap justify-center gap-3">
          {techInfo.muscles.map(m => (
            <span class="px-3 py-1 rounded-full border border-accent/20 bg-accent/5 text-[10px] font-bold uppercase tracking-widest text-accent">{m}</span>
          ))}
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-1 space-y-6">
          <Card variant="glass" class="p-6 reveal reveal-slide-right">
            <h3 class="text-xs font-bold uppercase tracking-widest text-accent mb-6 border-b border-white/5 pb-2">Log-Stats</h3>
            <div class="space-y-6">
              <div><p class="text-[10px] text-white/30 uppercase font-bold mb-1">Total Reps</p><div id="stat-total-reps" class="text-3xl font-black text-white italic">--</div></div>
              <div class="grid grid-cols-2 gap-4 pt-4 border-t border-white/5">
                <div><p class="text-[10px] text-white/30 uppercase font-bold">Max Reps/Set</p><p id="stat-max-reps" class="font-bold text-sm">--</p></div>
                <div><p class="text-[10px] text-white/30 uppercase font-bold">Total Sessions</p><p id="stat-total-sessions" class="font-bold text-sm">--</p></div>
              </div>
            </div>
          </Card>
        </div>

        <div class="lg:col-span-2 space-y-8">
          <Card variant="glass" class="p-6 reveal reveal-slide-up">
            <h3 class="text-xs font-bold uppercase tracking-widest text-white/40 mb-8">Volumen (Reps)</h3>
            <div class="min-h-[350px] w-full"><canvas id="progressionChart"></canvas></div>
            <p class="text-[10px] text-white/30 mt-4 italic text-center">Denne øvelse trackes primært på kropsvægt og reps.</p>
          </Card>
        </div>
      </div>
    </Section>
  </main>

  <script>
    import Chart from 'chart.js/auto';
    async function initStats() {
      try {
        const res = await fetch('/api/training');
        const allLogs = await res.json();
        const logs = allLogs.filter((l: any) => l.exercise_name?.toLowerCase().includes('leg raise')).sort((a: any, b: any) => new Date(a.date).getTime() - new Date(b.date).getTime());
        if (logs.length === 0) return;

        const totalReps = logs.reduce((sum: number, l: any) => sum + (l.reps || 0), 0);
        document.getElementById('stat-total-reps')!.innerText = totalReps.toString();
        document.getElementById('stat-max-reps')!.innerText = Math.max(...logs.map((l:any)=>l.reps)).toString();
        document.getElementById('stat-total-sessions')!.innerText = [...new Set(logs.map((l:any)=>l.date))].length.toString();

        const ctx = document.getElementById('progressionChart') as HTMLCanvasElement;
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: logs.map((l: any) => new Date(l.date).toLocaleDateString('da-DK', { day: 'numeric', month: 'short' })),
                datasets: [{ label: 'Reps', data: logs.map((l:any)=>l.reps), backgroundColor: 'rgba(212, 175, 55, 0.4)', borderColor: '#FFD700', borderWidth: 1 }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { ticks: { color: 'rgba(255, 255, 255, 0.3)', font: { size: 10 } }, grid: { display: false } }, y: { ticks: { color: 'rgba(255, 255, 255, 0.5)', font: { size: 10 } }, grid: { color: 'rgba(255, 255, 255, 0.05)' } } } }
        });
      } catch (e) { console.error(e); }
    }
    initStats();
  </script>
</Layout>
