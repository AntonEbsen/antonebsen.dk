---
---

<div id="chat-widget" class="fixed bottom-6 right-6 z-50 flex flex-col items-end pointer-events-none">
  
  <!-- Chat Window -->
  <div id="chat-window" class="w-[350px] h-[500px] mb-4 bg-glass border border-glass-border rounded-xl shadow-2xl flex flex-col transform translate-y-10 opacity-0 pointer-events-auto transition-all duration-300 origin-bottom-right hidden">
    
    <!-- Header -->
    <div class="p-4 border-b border-glass-border flex justify-between items-center bg-accent/5 rounded-t-xl">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-full bg-accent text-bg flex items-center justify-center">
          <i class="fa-solid fa-robot"></i>
        </div>
        <div>
          <h3 class="font-bold text-sm">Anton's AI</h3>
          <p class="text-[10px] text-accent flex items-center gap-1">
            <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Online
          </p>
        </div>
      </div>
      <button id="close-chat" class="text-dim hover:text-white transition-colors">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <!-- Messages -->
    <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4 scrollbar-hide text-sm">
      <div class="flex gap-2">
        <div class="w-6 h-6 rounded-full bg-accent/20 flex-shrink-0 flex items-center justify-center text-[10px] text-accent mt-1">
          <i class="fa-solid fa-robot"></i>
        </div>
        <div class="bg-glass-border/50 p-3 rounded-lg rounded-tl-none max-w-[85%]">
          <p>Hi! I'm Anton's AI assistant. Ask me anything about his experience, skills, or projects!</p>
        </div>
      </div>
      <!-- Messages will appear here -->
    </div>

    <!-- Input -->
    <div class="p-3 border-t border-glass-border bg-glass/50 rounded-b-xl">
      <form id="chat-form" class="flex gap-2">
        <input 
          type="text" 
          id="chat-input"
          placeholder="Ask a question..." 
          class="flex-1 bg-bg/50 border border-glass-border rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-accent/50 transition-colors placeholder:text-dim/50"
          autocomplete="off"
        />
        <button type="submit" class="bg-accent text-bg w-9 h-9 rounded-lg flex items-center justify-center hover:bg-white transition-colors">
          <i class="fa-solid fa-paper-plane text-xs"></i>
        </button>
      </form>
      <div class="text-[10px] text-center text-dim/30 mt-2">
        Powered by AI · May produce inaccuracies
      </div>
    </div>
  </div>

  <!-- Toggle Button -->
  <button id="chat-toggle" class="pointer-events-auto w-14 h-14 bg-accent text-bg rounded-full shadow-lg shadow-accent/20 flex items-center justify-center hover:bg-white hover:scale-110 transition-all duration-300 group">
    <i class="fa-solid fa-message text-xl group-hover:scale-110 transition-transform"></i>
  </button>

</div>

<script>
  // Simple chat toggle logic
  const widget = document.getElementById('chat-widget');
  const window = document.getElementById('chat-window');
  const toggle = document.getElementById('chat-toggle');
  const close = document.getElementById('close-chat');
  const form = document.getElementById('chat-form');
  const input = document.getElementById('chat-input') as HTMLInputElement;
  const messages = document.getElementById('chat-messages');

  let isOpen = false;

  function toggleChat() {
    isOpen = !isOpen;
    if (isOpen) {
      window.classList.remove('hidden');
      // Small timeout for transition
      setTimeout(() => {
        window.classList.remove('translate-y-10', 'opacity-0');
        toggle.classList.add('scale-0', 'opacity-0');
        // Hide toggle button visually but keep layout? No, just transform it out
        toggle.style.display = 'none'; 
      }, 10);
      input.focus();
    } else {
      window.classList.add('translate-y-10', 'opacity-0');
      toggle.style.display = 'flex';
      setTimeout(() => {
         toggle.classList.remove('scale-0', 'opacity-0');
      }, 10);
      setTimeout(() => {
        window.classList.add('hidden');
      }, 300);
    }
  }

  toggle.addEventListener('click', toggleChat);
  close.addEventListener('click', toggleChat);

  // Demo functionality
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const query = input.value.trim();
    if (!query) return;

    // User Message
    addMessage(query, 'user');
    input.value = '';

    // Simulate thinking
    showTyping();

    // Mock Response (Replace this with real API call)
    setTimeout(() => {
      removeTyping();
      const answer = getMockResponse(query);
      addMessage(answer, 'ai');
    }, 1500);
  });

  function addMessage(text, role) {
    const div = document.createElement('div');
    div.className = `flex gap-2 ${role === 'user' ? 'flex-row-reverse' : ''}`;
    
    if (role === 'ai') {
      div.innerHTML = `
        <div class="w-6 h-6 rounded-full bg-accent/20 flex-shrink-0 flex items-center justify-center text-[10px] text-accent mt-1">
          <i class="fa-solid fa-robot"></i>
        </div>
        <div class="bg-glass-border/50 p-3 rounded-lg rounded-tl-none max-w-[85%] text-left">
          <p>${text}</p>
        </div>
      `;
    } else {
      div.innerHTML = `
        <div class="bg-accent text-bg p-3 rounded-lg rounded-tr-none max-w-[85%] text-left">
          <p>${text}</p>
        </div>
      `;
    }
    
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function showTyping() {
    const div = document.createElement('div');
    div.id = 'typing-indicator';
    div.className = 'flex gap-2';
    div.innerHTML = `
       <div class="w-6 h-6 rounded-full bg-accent/20 flex-shrink-0 flex items-center justify-center text-[10px] text-accent mt-1">
          <i class="fa-solid fa-robot"></i>
        </div>
        <div class="bg-glass-border/50 p-3 rounded-lg rounded-tl-none">
          <div class="flex gap-1">
            <span class="w-1.5 h-1.5 bg-dim/50 rounded-full animate-bounce"></span>
            <span class="w-1.5 h-1.5 bg-dim/50 rounded-full animate-bounce" style="animation-delay: 0.1s"></span>
            <span class="w-1.5 h-1.5 bg-dim/50 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
          </div>
        </div>
    `;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function removeTyping() {
    const el = document.getElementById('typing-indicator');
    if (el) el.remove();
  }

  function getMockResponse(q) {
    q = q.toLowerCase();
    if (q.includes('experience') || q.includes('work')) return "Anton has experience as a Student Teacher at Djøf (Excel/VBA) and as an Office Assistant in Lübeck. He focuses on data, macros, and modeling.";
    if (q.includes('project') || q.includes('case')) return "He has worked on several projects, including a Global Financial Cycle bachelor thesis, RBC models, and heterogenous effects in the ECB.";
    if (q.includes('contact') || q.includes('email')) return "You can contact Anton at anton.ebsen@gmail.com.";
    return "This is a demo mode. To make me simpler and smarter (and read PDFs!), please connect me to an AI backend!";
  }

</script>
