
---
import '@styles/styles.css';
---

<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Illuminatio | Skrivestuen</title>
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Fonts -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon-cross.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        body { font-family: 'Cinzel', serif; }
        .text-body { font-family: 'Playfair Display', serif; }

        .parchment-bg {
            background-color: #f3e5ab;
            background-image: url("https://www.transparenttextures.com/patterns/parchment.png");
        }
        
        canvas {
            cursor: crosshair;
        }
        
        /* Gold Leaf Cursor could be added here */
    </style>
</head>
<body class="parchment-bg text-[#2c241b] min-h-screen flex flex-col items-center overflow-x-hidden selection:bg-gold-500/30">

    <!-- Nav -->
    <nav class="fixed top-8 left-8 z-50">
        <a href="/shrine" class="text-[#5c4d3c] hover:text-[#8b7355] transition-colors text-xl flex items-center gap-2">
            <i class="fa-solid fa-arrow-left"></i>
            <span class="text-xs uppercase tracking-widest hidden md:inline">Forlad Pulten</span>
        </a>
    </nav>

    <!-- Header -->
    <header class="mt-12 mb-8 text-center relative z-10">
        <h1 class="text-3xl text-[#2c241b] font-serif border-b-2 border-[#2c241b] pb-2 inline-block px-8">Illuminatio</h1>
        <p class="text-[10px] uppercase tracking-[0.3em] text-[#5c4d3c] mt-2">Forgyld Ordet</p>
    </header>

    <!-- WORKSPACE -->
    <div class="relative w-[300px] h-[300px] md:w-[500px] md:h-[500px] shadow-2xl bg-white rounded-sm mb-12 border border-[#d4c5a9] p-8 bg-[url('https://www.transparenttextures.com/patterns/paper.png')]">
        
        <!-- LETTER CONTAINER -->
        <div class="relative w-full h-full flex items-center justify-center">
            
            <!-- 1. The Mask/Guide (The Letter M) -->
            <!-- We draw this onto a canvas to use for collision detection, but visually we might want the Outline -->
            <!-- We'll use SVG for crisp visual, but Canvas for logic -->
            <svg viewBox="0 0 100 100" class="absolute inset-0 w-full h-full pointer-events-none opacity-20 z-0">
                <path d="M 20 80 L 20 20 L 50 50 L 80 20 L 80 80 M 15 20 L 25 20 M 15 80 L 25 80 M 75 20 L 85 20 M 75 80 L 85 80" 
                      fill="none" stroke="#000" stroke-width="2" />
            </svg>

            <!-- 2. The Interaction Canvas (Gold Layer) -->
            <canvas id="gold-canvas" class="absolute inset-0 w-full h-full z-10"></canvas>
            
            <!-- 3. The Letter Outline (Overlay) -->
            <!-- SVG sitting ON TOP so gold goes "under" the ink lines? Or gold IS the fill? -->
            <!-- Let's make gold the fill. So Outline is on top. -->
             <svg viewBox="0 0 100 100" class="absolute inset-0 w-full h-full pointer-events-none z-20 mix-blend-multiply">
                 <!-- Medieval "M" Outline -->
                  <defs>
                    <filter id="roughpaper">
                        <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="5" result="noise"/>
                        <feDiffuseLighting in="noise" lighting-color="#fff" surfaceScale="2">
                        <feDistantLight azimuth="45" elevation="60" />
                        </feDiffuseLighting>
                    </filter>
                </defs>
                <!-- Heavy Blackletter style path -->
                <path d="M 20 85 L 20 15 L 30 15 L 50 45 L 70 15 L 80 15 L 80 85 L 70 85 L 70 35 L 55 60 L 45 60 L 30 35 L 30 85 Z" 
                      fill="none" stroke="#2c241b" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            
        </div>
    </div>
    
    <!-- Controls / Inventory -->
    <div class="flex gap-8 items-center z-10">
        <div class="flex flex-col items-center">
            <span class="text-[9px] uppercase tracking-widest text-[#5c4d3c] mb-1">Bladguld</span>
            <div class="w-32 h-2 bg-[#d4c5a9] rounded-full overflow-hidden border border-[#bfae8f]">
                <div id="gold-supply" class="w-full h-full bg-gradient-to-r from-yellow-300 via-yellow-500 to-yellow-600"></div>
            </div>
        </div>
        
        <button onclick="resetCanvas()" class="text-[9px] uppercase tracking-widest text-[#5c4d3c] hover:text-black border border-[#d4c5a9] px-4 py-2 hover:bg-[#d4c5a9]/20 transition-colors">
            Start Forfra
        </button>
    </div>
    
    <!-- Instructions -->
    <p class="text-xs text-body italic text-[#5c4d3c] mt-8 text-center max-w-md opacity-80">
        Klik og træk for at påføre bladguld.<br>
        Udfyld bogstavet med tålmodighed.
    </p>

    <script>
        const canvas = document.getElementById('gold-canvas');
        const ctx = canvas.getContext('2d');
        const supplyBar = document.getElementById('gold-supply');
        
        let width, height;
        let goldSupply = 100; // Percent
        let isPainting = false;
        
        // Define the letter shape path for collision/masking
        // Normalized coordinates 0-100
        const letterPath = new Path2D("M 20 85 L 20 15 L 30 15 L 50 45 L 70 15 L 80 15 L 80 85 L 70 85 L 70 35 L 55 60 L 45 60 L 30 35 L 30 85 Z");

        function resize() {
            // Get CSS size
            const rect = canvas.getBoundingClientRect();
            // Set canvas size to match resolution (High DPI)
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            // Adjust scale factor for path (0-100 coordinate space -> Canvas width/height)
            width = rect.width;
            height = rect.height;
            
            render();
        }
        
        window.addEventListener('resize', resize);
        
        
        function render() {
           // We keep drawing on the canvas, so just init needed?
           // Actually createGoldPattern if not created
        }

        function getScaledPath() {
             // Create a transform matrix to scale the Path2D to the canvas size?
             // Canvas Path2D API is limited in transforms. 
             // Easiest is to scale the context before drawing/checking.
             const sX = width / 100;
             const sY = height / 100;
             
             // We can check collision by point modification
             return { sX, sY };
        }

        function applyGold(x, y) {
            if(goldSupply <= 0) return;
            
            // Check if point is inside letter
            const { sX, sY } = getScaledPath();
            
            // To check point in path, we need to scale the context or the path.
            // Let's rely on COMPOSITE OPERATION 'source-in' for visual masking instead of perfect collision.
            // Because collision checking perfectly on hover is expensive? No, simplistic is fine.
            // Actually, best visual result:
            // 1. Draw Brush Stroke.
            // 2. Use 'destination-in' with the Letter Shape to clip it?
            //    No, that clears outside. We want to KEEP what we drew if it's inside.
            //    Correct: 1. Draw Gold Stroke (on temp canvas?). 2. Draw Letter Shape as mask.
            
            // Simpler approach for "Satisfying":
            // User draws freely on the canvas. 
            // We set the canvas clip() to the letter path at the start.
            // This prevents drawing outside.
            
            ctx.save();
            ctx.scale(sX, sY); // Scale to 0-100 system
            ctx.clip(letterPath); // CLIP TO LETTER!
            ctx.scale(1/sX, 1/sY); // Unscale to draw in pixel coords
            
            // Draw Gold Flake
            // Randomize size slightly
            const size = 15 + Math.random() * 10;
            
            // Gold Gradient/Texture
            const grad = ctx.createRadialGradient(x, y, 0, x, y, size);
            grad.addColorStop(0, "#FFD700");
            grad.addColorStop(0.5, "#FDB931");
            grad.addColorStop(1, "#B8860B");
            
            ctx.fillStyle = grad;
            
            // Irregular brush shape
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI*2);
            ctx.fill();
            
            // Add some "texture" scratches
            ctx.strokeStyle = "rgba(255,255,255,0.4)";
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x - size/2, y - size/2);
            ctx.lineTo(x + size/2, y + size/2);
            ctx.stroke();

            ctx.restore();
            
            // Reduce Supply
            goldSupply -= 0.2; // approx 500 strokes
            if(goldSupply < 0) goldSupply = 0;
            supplyBar.style.width = `${goldSupply}%`;
        }

        // Mouse Events
        canvas.addEventListener('mousedown', (e) => {
            isPainting = true;
            const rect = canvas.getBoundingClientRect();
            applyGold(e.clientX - rect.left, e.clientY - rect.top);
        });
        
        window.addEventListener('mouseup', () => isPainting = false);
        
        canvas.addEventListener('mousemove', (e) => {
            if(!isPainting) return;
            // Throttle?
            const rect = canvas.getBoundingClientRect();
            applyGold(e.clientX - rect.left, e.clientY - rect.top);
        });
        
        // Touch support
        canvas.addEventListener('touchstart', (e) => {
            isPainting = true;
            e.preventDefault(); // prevent scroll
        });
        canvas.addEventListener('touchmove', (e) => {
            if(!isPainting) return;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            applyGold(touch.clientX - rect.left, touch.clientY - rect.top);
             e.preventDefault();
        });

        (window as any).resetCanvas = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            goldSupply = 100;
            supplyBar.style.width = '100%';
        };

        // Init
        setTimeout(resize, 100);

    </script>
</body>
</html>
