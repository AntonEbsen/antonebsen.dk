---
import StudyGroupLayout from '../../layouts/study-group/StudyGroupBaseLayout.astro';
import { createClient } from '@supabase/supabase-js';

export const prerender = false;

// Supabase Init
const supabaseUrl = import.meta.env.SUPABASE_URL;
const supabaseKey = import.meta.env.SUPABASE_ANON_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

let events = [];
try {
    const { data } = await supabase
        .from('study_group_events')
        .select('*')
        .order('date', { ascending: true });
    events = data || [];
} catch (e) {}

const days = ['Man', 'Tir', 'Ons', 'Tor', 'Fre', 'Lør', 'Søn'];
const hours = Array.from({ length: 14 }, (_, i) => i + 8); // 8:00 to 21:00
---

<StudyGroupLayout title="Kollektiv Kalender" activePage="calendar">
    <div class="space-y-16">
        <div class="flex items-center justify-between">
            <h2 class="text-6xl font-black italic tracking-tighter text-white uppercase">Planøkonomi <br/> <span class="text-red-600">Kalender</span></h2>
            <button class="bg-red-600 hover:bg-red-700 text-white px-8 py-4 rounded-2xl text-[12px] font-black uppercase tracking-widest transition-all shadow-glow-red">Planlæg Møde +</button>
        </div>

        {/* Real Digital Calendar Grid */}
        <div class="bg-white/[0.02] border border-white/5 rounded-[48px] overflow-hidden">
            <div class="grid grid-cols-8 border-b border-white/5">
                <div class="p-4 border-r border-white/5 bg-white/[0.02]"></div>
                {days.map(day => (
                    <div class="p-4 text-center text-[10px] font-black uppercase tracking-widest text-white/40 border-r border-white/5 last:border-0">{day}</div>
                ))}
            </div>

            <div class="relative">
                {hours.map(hour => (
                    <div class="grid grid-cols-8 border-b border-white/5 last:border-0 group">
                        <div class="p-4 text-right text-[10px] font-black tabular-nums text-white/20 border-r border-white/5 bg-white/[0.01]">
                            {hour}:00
                        </div>
                        {days.map(() => (
                            <div class="h-24 border-r border-white/5 last:border-0 hover:bg-red-600/5 transition-colors cursor-crosshair relative">
                                {/* Sample Meeting */}
                                {hour === 10 && Math.random() > 0.8 && (
                                    <div class="absolute inset-2 bg-red-600/20 border border-red-600/40 rounded-xl p-3 space-y-1 overflow-hidden">
                                        <p class="text-[8px] font-black uppercase text-red-600 leading-tight">Seminar-møde</p>
                                        <p class="text-[7px] text-white/40 leading-tight">CSS lokale 5.0.3</p>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                ))}
            </div>
        </div>

        {/* Upcoming Events List */}
        <section class="space-y-8 max-w-2xl">
            <h3 class="text-2xl font-black uppercase tracking-tighter italic">Kommende dekreter</h3>
            <div class="space-y-4">
                {events.length > 0 ? events.map(event => (
                    <div class="flex items-center gap-6 p-6 bg-white/[0.03] border border-white/5 rounded-3xl group hover:border-red-600/30 transition-all">
                        <div class="w-16 h-16 flex flex-col items-center justify-center bg-red-600/10 rounded-2xl border border-red-600/20 group-hover:bg-red-600 group-hover:text-white transition-all text-red-600">
                            <span class="text-xs font-black uppercase">{new Date(event.date).toLocaleDateString('da-DK', { month: 'short' })}</span>
                            <span class="text-xl font-black leading-none">{new Date(event.date).getDate()}</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-lg text-white uppercase tracking-tight">{event.title}</h4>
                            <p class="text-white/40 text-xs italic">{event.location || "CSS"}</p>
                        </div>
                    </div>
                )) : (
                    <p class="text-white/20 italic text-sm px-6">Ingen planlagte møder for masserne i øjeblikket.</p>
                )}
            </div>
        </section>
    </div>
</StudyGroupLayout>


