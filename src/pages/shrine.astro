
---
import '@styles/styles.css';
import { getLiturgicalSeason } from '../utils/liturgy';

// Liturgical Atmosphere
const season = getLiturgicalSeason(new Date());

const seasonGradients: Record<string, string> = {
    green:  'from-[#0a150a] via-black to-black', // Ordinary Time (Deep Green)
    purple: 'from-[#150515] via-black to-black', // Advent/Lent (Deep Purple)
    white:  'from-[#151205] via-black to-black', // Easter/Christmas (Deep Gold)
    red:    'from-[#150505] via-black to-black', // Pentecost/Martyrs (Deep Red)
    black:  'from-[#0a0a0a] via-black to-black'
};

// Default to green if undefined
const currentGradient = seasonGradients[season.color] || seasonGradients.green;
---

<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Majorem Dei Gloriam ‚úùÔ∏è</title>
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Fonts: Inter + Cinzel (Serif) -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon-cross.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        body { font-family: 'Cinzel', serif; }
        .sans { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-[#020205] text-white overflow-hidden h-screen w-screen m-0 p-0 selection:bg-gold-500/30">

    <!-- TOP BAR (Constrained) -->
    <div class="absolute top-0 w-full max-w-7xl px-8 py-8 flex justify-between items-start z-50 pointer-events-none">
        <!-- BACK BUTTON -->
        <a href="/" class="pointer-events-auto text-gold-500/60 hover:text-gold-400 transition-colors text-xl flex items-center gap-2 sans">
            <i class="fa-solid fa-arrow-left"></i>
            <span class="text-xs uppercase tracking-widest hidden md:inline">Return</span>
        </a>

        <!-- SEASON INDICATOR (New) -->
        <div class="hidden md:block text-center opacity-40 hover:opacity-100 transition-opacity pointer-events-auto cursor-help" title={season.description}>
            <span class="text-[10px] uppercase tracking-[0.3em] block text-gold-500">{season.name}</span>
        </div>

        <!-- AUDIO CONTROL -->
        <button id="mute-btn" class="pointer-events-auto text-gold-500/60 hover:text-gold-400 transition-colors text-xl flex items-center gap-2 group" aria-label="Mute/Play">
            <i class="fa-solid fa-volume-high group-hover:block hidden"></i>
            <i class="fa-solid fa-volume-xmark group-hover:hidden block"></i>
            <i class="fa-solid fa-play hidden text-gold-500"></i>
            <span class="text-[10px] uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity sans">Chant</span>
        </button>
    </div>

    <!-- MAIN CONTAINER (Full Screen) -->
    <div class={`relative w-full h-full flex flex-col items-center justify-center font-serif text-center select-none overflow-hidden bg-gradient-to-b ${currentGradient} transition-colors duration-1000`}>

        <!-- Background Texture (Subtle Noise) -->
        <div class="absolute inset-0 opacity-20 pointer-events-none" style="background-image: url('https://www.transparenttextures.com/patterns/stardust.png');"></div>

        <!-- INCENSE SMOKE EFFECT üå´Ô∏è (Boosted Opacity) -->
        <div class="absolute inset-0 z-0 pointer-events-none overflow-hidden opacity-60 mix-blend-screen">
             <!-- Deep rolling fog -->
             <div class="absolute -bottom-20 left-1/4 w-[600px] h-[600px] bg-gray-600/20 rounded-full blur-[100px] animate-smoke-rise"></div>
             <div class="absolute -bottom-32 right-1/4 w-[700px] h-[700px] bg-gray-500/10 rounded-full blur-[120px] animate-smoke-rise-slow"></div>
             <!-- Center Glow -->
             <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-96 h-96 bg-gold-600/10 rounded-full blur-[80px] animate-pulse-slow"></div>
        </div>
    
        <!-- CATHEDRAL LAYOUT / DASHBOARD -->
        <div class="relative w-full h-full flex flex-col items-center justify-center p-4 md:p-12 overflow-y-auto">
            
            <div class="grid grid-cols-2 md:grid-cols-5 gap-6 md:gap-8 max-w-[95vw] w-full relative z-10 py-10 items-start">
                
                <!-- COL 1: STUDIUM (The Mind) -->
                <div class="col-span-1 flex flex-col gap-4">
                     <div class="text-[9px] uppercase tracking-widest text-gray-600 mb-2 border-b border-gray-800 pb-1">Studium</div>
                     <a href="/shrine/library" class="shrine-btn group"><i class="fa-solid fa-book text-gold-500/50 group-hover:text-gold-400 w-5"></i> Bibliotheca</a>
                     <a href="/shrine/aquinas" class="shrine-btn group"><i class="fa-solid fa-feather text-gold-500/50 group-hover:text-gold-400 w-5"></i> Aquinas</a>
                     <a href="/shrine/scriptorium" class="shrine-btn group"><i class="fa-solid fa-pen-nib text-gold-500/50 group-hover:text-gold-400 w-5"></i> Scriptorium</a>
                     <a href="/shrine/lectio" class="shrine-btn group"><i class="fa-solid fa-comment-dots text-gold-500/50 group-hover:text-gold-400 w-5"></i> Lectio Divina</a>
                     <a href="/shrine/testimony" class="shrine-btn group"><i class="fa-solid fa-quote-right text-gold-500/50 group-hover:text-gold-400 w-5"></i> Vidnesbyrd</a>
                </div>

                <!-- COL 2: POENITENTIA (The Soul) -->
                <div class="col-span-1 flex flex-col gap-4">
                     <div class="text-[9px] uppercase tracking-widest text-gray-600 mb-2 border-b border-gray-800 pb-1">Poenitentia</div>
                     <a href="/shrine/via-dolorosa" class="shrine-btn group"><i class="fa-solid fa-road text-gold-500/50 group-hover:text-gold-400 w-5"></i> Via Dolorosa</a>
                     <a href="/shrine/confession" class="shrine-btn group"><i class="fa-solid fa-user-secret text-gold-500/50 group-hover:text-gold-400 w-5"></i> Skriftem√•l</a>
                     <a href="/shrine/speculum" class="shrine-btn group"><i class="fa-solid fa-mirror text-gold-500/50 group-hover:text-gold-400 w-5"></i> Speculum</a>
                     <a href="/shrine/catacombs" class="shrine-btn group"><i class="fa-solid fa-skull text-gold-500/50 group-hover:text-gold-400 w-5"></i> Katakomberne</a>
                </div>

                <!-- COL 3: SANCTUARIUM (Center / Liturgy) -->
                <div class="col-span-2 md:col-span-1 flex flex-col items-center gap-8 pt-4 md:pt-8 order-first md:order-none">
                     <!-- Altar -->
                     <div class="relative group cursor-pointer transform hover:scale-105 transition-transform duration-1000">
                        <a href="/shrine/adoration" class="block relative z-10">
                            <div class="absolute inset-0 bg-gold-500/10 blur-[60px] rounded-full animate-pulse-slow"></div>
                             <svg width="60" height="80" viewBox="0 0 24 30" xmlns="http://www.w3.org/2000/svg" class="mx-auto overflow-visible drop-shadow-[0_0_25px_rgba(255,215,0,0.4)]">
                                <path d="M10 2 H14 V6 H22 V10 H14 V28 H10 V10 H2 V6 H10 V2 Z" fill="#FFD700" opacity="0.9" />
                                <circle cx="12" cy="7.5" r="1.5" fill="#FFE55C" />
                            </svg>
                        </a>
                    </div>
                    
                    <!-- Calendar & Stoup Row -->
                    <div class="flex gap-6 justify-center">
                         <a href="/shrine/calendar" class="text-xs uppercase tracking-widest text-gray-500 hover:text-gold-500 transition-colors flex flex-col items-center gap-1 group">
                             <i class="fa-solid fa-calendar-day group-hover:scale-110 transition-transform"></i> <span class="text-[8px]">Kalender</span>
                         </a>
                         
                         <!-- Bell -->
                         <div id="bell-rope" class="text-xs uppercase tracking-widest text-gray-500 hover:text-gold-500 transition-colors flex flex-col items-center gap-1 group cursor-pointer">
                             <div class="h-8 w-0.5 bg-gray-700 group-hover:h-10 transition-all origin-top relative" id="rope-line">
                                 <div class="w-1.5 h-2 bg-gold-900 absolute bottom-0 -left-0.5 rounded-full" id="rope-knot"></div>
                             </div>
                             <span class="text-[8px]">Angelus</span>
                         </div>
                    </div>

                    <!-- Water -->
                     <div class="relative group cursor-pointer flex flex-col items-center opacity-60 hover:opacity-100 transition-opacity" id="stoup-trigger">
                         <div class="w-12 h-6 border-b border-r border-l border-cyan-500/30 rounded-b-full flex items-center justify-center relative overflow-hidden bg-cyan-900/10 transition-shadow group-hover:shadow-[0_0_10px_rgba(0,255,255,0.2)]">
                              <div id="ripple-container" class="absolute inset-0 flex items-center justify-center pointer-events-none text-cyan-200"></div>
                         </div>
                         <span class="text-[8px] uppercase tracking-widest text-gray-600 mt-1">Vievand</span>
                          <!-- Floating Text -->
                             <div id="blessing-text" class="absolute -top-6 left-1/2 -translate-x-1/2 text-gold-200 font-serif italic whitespace-nowrap opacity-0 pointer-events-none transition-all duration-1000 transform translate-y-2 text-xs">
                                "In Nomine Patris..."
                             </div>
                     </div>
                </div>

                <!-- COL 4: ORATIO (Prayer) -->
                <div class="col-span-1 flex flex-col gap-4">
                     <div class="text-[9px] uppercase tracking-widest text-gray-600 mb-2 border-b border-gray-800 pb-1">Oratio</div>
                     <a href="/shrine/prayers" class="shrine-btn group"><i class="fa-solid fa-hands-praying text-gold-500/50 group-hover:text-gold-400 w-5"></i> Forb√∏n</a>
                     <a href="/shrine/candles" class="shrine-btn group"><i class="fa-solid fa-fire text-orange-500/50 group-hover:text-orange-400 w-5 text-[10px]"></i> Lyskapellet</a>
                     <a href="/shrine/treasury" class="shrine-btn group"><i class="fa-solid fa-crown text-gold-500/50 group-hover:text-gold-400 w-5"></i> Skatkammeret</a>
                     <a href="/shrine/rosary" class="shrine-btn group"><i class="fa-solid fa-dharmachakra text-gold-500/50 group-hover:text-gold-400 w-5"></i> Rosenkransen</a>
                </div>
                
                 <!-- COL 5: MYSTERIUM (Sensory) -->
                <div class="col-span-1 flex flex-col gap-4">
                     <div class="text-[9px] uppercase tracking-widest text-gray-600 mb-2 border-b border-gray-800 pb-1">Mysterium</div>
                     <a href="/shrine/hortus-conclusus" class="shrine-btn group"><i class="fa-solid fa-seedling text-green-500/50 group-hover:text-green-400 w-5"></i> Jomfruens Have</a>
                     <a href="/shrine/rose-window" class="shrine-btn group"><i class="fa-solid fa-fan text-pink-500/50 group-hover:text-pink-400 w-5"></i> Rosevinduet</a>
                     <a href="/shrine/organ-loft" class="shrine-btn group"><i class="fa-solid fa-music text-purple-500/50 group-hover:text-purple-400 w-5"></i> Orglet</a>
                     <a href="/shrine/thurible" class="shrine-btn group"><i class="fa-solid fa-wind text-gray-500/50 group-hover:text-gray-400 w-5"></i> R√∏gelseskarret</a>
                </div>

            </div>

            <!-- Decorative Floor Lines -->
             <div class="absolute inset-x-0 bottom-10 h-px bg-gradient-to-r from-transparent via-gray-900 to-transparent pointer-events-none"></div>
        </div>
    
    </div>

    <!-- Hidden Audio Player -->
    <audio id="shrine-audio" loop preload="auto">
        <source src="/assets/audio/chant.mp3" type="audio/mpeg">
    </audio>
    <audio id="bell-audio" preload="auto">
        <source src="/assets/audio/bell.mp3" type="audio/mpeg">
    </audio>

</body>
</html>


<script>
    // Audio Elements
    const audio = document.getElementById('shrine-audio') as HTMLAudioElement;
    const muteBtn = document.getElementById('mute-btn');
    const volIcon = muteBtn?.querySelector('.fa-volume-high');
    const muteIcon = muteBtn?.querySelector('.fa-volume-xmark');
    const playIcon = muteBtn?.querySelector('.fa-play');
    
    // Start Logic on Load
    window.addEventListener('load', async () => {
        // Try Autoplay
        audio.volume = 1.0;
        try {
            await audio.play();
            // Success
            volIcon?.classList.remove('hidden');
            muteIcon?.classList.add('hidden');
            playIcon?.classList.add('hidden');
        } catch (e) {
            console.log("Autoplay blocked. Showing Play button.", e);
            // Fallback
            volIcon?.classList.add('hidden');
            muteIcon?.classList.add('hidden');
            playIcon?.classList.remove('hidden');
            muteBtn?.classList.add('animate-pulse');
        }
    });

    // Mute/Play Control
    muteBtn?.addEventListener('click', async () => {
        if (audio.paused) {
            // Manual Start
            try {
                await audio.play();
                volIcon?.classList.remove('hidden');
                muteIcon?.classList.add('hidden');
                playIcon?.classList.add('hidden');
                muteBtn.classList.remove('animate-pulse');
            } catch(e) { console.error(e); }
        } else {
            // Toggle Mute
            audio.muted = !audio.muted;
            if(audio.muted) {
                volIcon?.classList.add('hidden');
                muteIcon?.classList.remove('hidden');
            } else {
                volIcon?.classList.remove('hidden');
                muteIcon?.classList.add('hidden');
            }
        }
    });

    // Holy Water Stoup
    const stoupTrigger = document.getElementById('stoup-trigger');
    const rippleContainer = document.getElementById('ripple-container');
    const blessingText = document.getElementById('blessing-text');

    stoupTrigger?.addEventListener('click', () => {
        // Create Ripple
        const ripple = document.createElement('div');
        ripple.className = "ripple-effect";
        rippleContainer?.appendChild(ripple);
        
        // Cleanup Ripple
        setTimeout(() => ripple.remove(), 800);

        // Show Text
        if(blessingText) {
            blessingText.classList.remove('opacity-0', 'translate-y-2');
            blessingText.classList.add('opacity-100', 'translate-y-0');
            
            // Hide after 2s
            setTimeout(() => {
                blessingText.classList.remove('opacity-100', 'translate-y-0');
                blessingText.classList.add('opacity-0', 'translate-y-2'); 
            }, 2000);
        }
    });

    // Bell Tower (Angelus)
    const bellRope = document.getElementById('bell-rope');
    const ropeLine = document.getElementById('rope-line');
    const ropeKnot = document.getElementById('rope-knot');
    const bellAudio = document.getElementById('bell-audio');

    function ringBell() {
        // visual pull
        ropeLine?.classList.add('scale-y-[1.2]');
        ropeKnot?.classList.add('translate-y-6');
        setTimeout(() => {
            ropeLine?.classList.remove('scale-y-[1.2]');
            ropeKnot?.classList.remove('translate-y-6');
        }, 300);

        // sound
        if(bellAudio) {
            (bellAudio as HTMLAudioElement).currentTime = 0;
            (bellAudio as HTMLAudioElement).play().catch(e => console.log("Audio ignored", e));
        }
    }

    bellRope?.addEventListener('click', ringBell);

    // Initial Angelus Check
    const now = new Date();
    const h = now.getHours();
    const m = now.getMinutes();
    // 12:00 or 18:00 (6 PM) window (let's say first 2 minutes)
    if((h === 12 || h === 18) && m < 5) {
        // Pulse animation to invite ringing (since we can't auto-play sound mostly)
        bellRope?.classList.add('animate-bounce');
    }
</script>

<style>
    .shrine-card {
        display: block;
        padding: 1.5rem;
        border: 1px solid transparent;
        background: transparent;
        transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        position: relative;
    }
    .shrine-card:hover {
        border-color: rgba(255, 215, 0, 0.1);
        background: rgba(255, 215, 0, 0.02);
        transform: translateX(5px);
    }
    /* Reverse hover for Left side */
    .items-end .shrine-card:hover {
            transform: translateX(-5px);
    }
    
    .shrine-btn {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem 0.5rem;
        color: #888;
        font-family: 'Cinzel', serif;
        font-size: 0.85rem;
        transition: all 0.3s ease;
        border-radius: 4px;
        letter-spacing: 0.05em;
    }
    .shrine-btn:hover {
        color: #fff;
        background: rgba(255, 255, 255, 0.05);
        transform: translateX(5px);
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    }

    /* KEYFRAMES */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in-up {
        animation: fadeInUp 1.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        opacity: 0;
    }

    .animate-pulse-slow {
        animation: pulse 8s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes smokeRise {
        0% { transform: translateY(0) scale(1); opacity: 0.3; }
        50% { transform: translateY(-30px) scale(1.1); opacity: 0.2; }
        100% { transform: translateY(-60px) scale(1.2); opacity: 0; }
    }
    
    .animate-smoke-rise {
        animation: smokeRise 15s infinite ease-in-out;
    }
    
    .animate-smoke-rise-slow {
        animation: smokeRise 25s infinite ease-in-out reverse;
    }

    @keyframes flicker {
        0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.8; }
        50% { transform: translateX(-50%) scale(1.1); opacity: 1; filter: brightness(1.2); }
        25% { transform: translateX(-52%) scale(0.9); opacity: 0.7; }
        75% { transform: translateX(-48%) scale(1.05); opacity: 0.9; }
    }

    .animate-flicker {
        animation: flicker 0.1s infinite alternate;
    }

    /* RIPPLE */
    @keyframes ripple {
        0% { transform: scale(0); opacity: 0.5; }
        100% { transform: scale(3); opacity: 0; }
    }
    .ripple-effect {
        position: absolute;
        width: 100%;
        height: 100%; /* Fill container */
        background: radial-gradient(circle, rgba(0,255,255,0.2) 0%, transparent 70%);
        border-radius: 50%;
        animation: ripple 0.8s ease-out forwards;
    }
</style>
