---
import { getLangFromUrl } from '@i18n/utils';
const lang = getLangFromUrl(Astro.url);
const label = lang === 'en' ? 'Language' : 'Sprog';
---
<div class="nav-item has-dropdown lang-switch">
  <button type="button" class="nav-link lang-btn" aria-label="Skift sprog" aria-haspopup="true" aria-expanded="false">
    {label} <span aria-hidden="true">â–¾</span>
  </button>

  <div class="dropdown" role="menu" aria-label="Sprogvalg">
    <a href="/" role="menuitem" class="lang-link">
      <span class="lang-text">Dansk</span>
    </a>

    <a href="/en" role="menuitem" class="lang-link">
      <span class="lang-text">English</span>
    </a>

    <!-- <a href="/de" role="menuitem" class="lang-link">
      <span class="lang-text">Deutsch</span>
    </a> -->
  </div>
</div>

<script>
  // Simple logic to handle dropdown toggle on click for touch devices / accessibility
  document.addEventListener('DOMContentLoaded', () => {
    const langBtns = document.querySelectorAll('.lang-btn');
    
    langBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const parent = btn.closest('.has-dropdown');
        if (parent) {
            parent.classList.toggle('open');
            const expanded = parent.classList.contains('open');
            btn.setAttribute('aria-expanded', String(expanded));
        }
      });
    });

    // Close when clicking outside
    document.addEventListener("click", (e) => {
      if (!e.target) return;
      const target = e.target as HTMLElement;
      
      if (!target.closest(".lang-switch")) {
        document.querySelectorAll(".lang-switch.open").forEach(el => {
            el.classList.remove("open");
            const btn = el.querySelector('.lang-btn');
            if(btn) btn.setAttribute('aria-expanded', 'false');
        });
      }
    });
  });
</script>

<style>
    /* Reset button styles */
    .lang-btn {
        background: none;
        border: none;
        cursor: pointer;
        font: inherit;
        color: inherit;
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 0 12px; 
    }

    .dropdown {
        position: absolute;
        top: 100%;
        width: max-content;
        min-width: 120px;
        right: 0;
        background: #111;
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 8px;
        padding: 8px 0;
        visibility: hidden;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.2s ease;
        z-index: 1000;
        box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    }

    .has-dropdown.open .dropdown,
    .has-dropdown:hover .dropdown { /* Optional: Uncomment for hover behavior */
        visibility: visible;
        opacity: 1;
        transform: translateY(0);
    }

    .lang-link {
        display: block;
        padding: 8px 16px;
        color: #888;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.2s;
    }

    .lang-link:hover {
        background: rgba(255,255,255,0.05);
        color: #fff;
    }
</style>

