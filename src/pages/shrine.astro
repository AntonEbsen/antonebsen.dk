
---
import '@styles/styles.css';
import { getLiturgicalSeason } from '../utils/liturgy';

// Liturgical Atmosphere
const season = getLiturgicalSeason(new Date());

const seasonGradients: Record<string, string> = {
    green:  'from-[#0a150a] via-black to-black', // Ordinary Time (Deep Green)
    purple: 'from-[#150515] via-black to-black', // Advent/Lent (Deep Purple)
    white:  'from-[#151205] via-black to-black', // Easter/Christmas (Deep Gold)
    red:    'from-[#150505] via-black to-black', // Pentecost/Martyrs (Deep Red)
    black:  'from-[#0a0a0a] via-black to-black'
};

// Default to green if undefined
const currentGradient = seasonGradients[season.color] || seasonGradients.green;
---

<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Majorem Dei Gloriam ‚úùÔ∏è</title>
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Fonts: Inter + Cinzel (Serif) -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon-cross.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        body { font-family: 'Cinzel', serif; }
        .sans { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-[#020205] text-white overflow-hidden h-screen w-screen m-0 p-0 selection:bg-gold-500/30">

    <!-- TOP BAR (Constrained) -->
    <div class="absolute top-0 w-full max-w-7xl px-8 py-8 flex justify-between items-start z-50 pointer-events-none">
        <!-- BACK BUTTON -->
        <a href="/" class="pointer-events-auto text-gold-500/60 hover:text-gold-400 transition-colors text-xl flex items-center gap-2 sans">
            <i class="fa-solid fa-arrow-left"></i>
            <span class="text-xs uppercase tracking-widest hidden md:inline">Return</span>
        </a>

        <!-- SEASON INDICATOR (New) -->
        <div class="hidden md:block text-center opacity-40 hover:opacity-100 transition-opacity pointer-events-auto cursor-help" title={season.description}>
            <span class="text-[10px] uppercase tracking-[0.3em] block text-gold-500">{season.name}</span>
        </div>

        <!-- AUDIO CONTROL -->
        <button id="mute-btn" class="pointer-events-auto text-gold-500/60 hover:text-gold-400 transition-colors text-xl flex items-center gap-2 group" aria-label="Mute/Play">
            <i class="fa-solid fa-volume-high group-hover:block hidden"></i>
            <i class="fa-solid fa-volume-xmark group-hover:hidden block"></i>
            <i class="fa-solid fa-play hidden text-gold-500"></i>
            <span class="text-[10px] uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity sans">Chant</span>
        </button>
    </div>

    <!-- MAIN CONTAINER (Full Screen) -->
    <div class={`relative w-full h-full flex flex-col items-center justify-center font-serif text-center select-none overflow-hidden bg-gradient-to-b ${currentGradient} transition-colors duration-1000`}>

        <!-- Background Texture (Subtle Noise) -->
        <div class="absolute inset-0 opacity-20 pointer-events-none" style="background-image: url('https://www.transparenttextures.com/patterns/stardust.png');"></div>

        <!-- INCENSE SMOKE EFFECT üå´Ô∏è (Boosted Opacity) -->
        <div class="absolute inset-0 z-0 pointer-events-none overflow-hidden opacity-60 mix-blend-screen">
             <!-- Deep rolling fog -->
             <div class="absolute -bottom-20 left-1/4 w-[600px] h-[600px] bg-gray-600/20 rounded-full blur-[100px] animate-smoke-rise"></div>
             <div class="absolute -bottom-32 right-1/4 w-[700px] h-[700px] bg-gray-500/10 rounded-full blur-[120px] animate-smoke-rise-slow"></div>
             <!-- Center Glow -->
             <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-96 h-96 bg-gold-600/10 rounded-full blur-[80px] animate-pulse-slow"></div>
        </div>
    
        <!-- CATHEDRAL LAYOUT -->
        <div class="relative w-full h-full flex items-center justify-center p-4 overflow-y-auto">
            
            <!-- Floorplan Grid (Cross Shape) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-16 max-w-7xl w-full relative z-10 py-20">
                
                <!-- WEST WING (Theology / Left) -->
                <div class="col-span-1 flex flex-col gap-8 justify-center items-center md:items-end order-2 md:order-1 animate-fade-in-up" style="animation-delay: 0.2s;">
                    <a href="/shrine/aquinas" class="shrine-card group text-center md:text-right w-64 md:w-auto">
                        <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Schola Theologica</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Thomas Aquinas</h2>
                        <p class="text-xs text-gray-500 mt-2 opacity-60 group-hover:opacity-100 transition-opacity italic font-serif">"Doctor Angelicus"</p>
                    </a>
                    <a href="/shrine/scriptorium" class="shrine-card group text-center md:text-right w-64 md:w-auto">
                        <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Scriptorium</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Skrivestuen</h2>
                        <p class="text-xs text-gray-500 mt-2 opacity-60 group-hover:opacity-100 transition-opacity italic font-serif">Meditativ Afskrift</p>
                    </a>
                    <a href="/shrine/library" class="shrine-card group text-center md:text-right w-64 md:w-auto">
                        <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Bibliotheca</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Biblioteket</h2>
                        <p class="text-xs text-gray-500 mt-2 opacity-60 group-hover:opacity-100 transition-opacity italic font-serif">Viden & Apologetik</p>
                    </a>
                    <a href="/shrine/via-dolorosa" class="shrine-card group text-center md:text-right w-64 md:w-auto">
                        <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Pilgrimsf√¶rd</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Via Dolorosa</h2>
                        <p class="text-xs text-gray-500 mt-2 opacity-60 group-hover:opacity-100 transition-opacity italic font-serif">Korsets Vej</p>
                    </a>
                    <a href="/shrine/testimony" class="shrine-card group text-center md:text-right w-64 md:w-auto">
                        <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Martyrologium</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Vidnesbyrd</h2>
                    </a>
                </div>

                <!-- NAVE (Center / Axis Mundi) -->
                <div class="col-span-1 flex flex-col items-center gap-16 order-1 md:order-2 animate-fade-in-up">
                    
                    <!-- Narthex (Calendar & Stoup) -->
                    <div class="flex flex-col items-center gap-8">
                        <div class="text-center group">
                            <a href="/shrine/calendar" class="inline-block relative">
                                <div class="w-12 h-12 mx-auto border border-gold-500/20 rounded-full flex items-center justify-center mb-3 group-hover:border-gold-500/50 transition-colors">
                                    <i class="fa-solid fa-calendar-day text-gold-500/80 text-sm"></i>
                                </div>
                                <span class="text-[10px] uppercase tracking-[0.3em] text-gray-500 group-hover:text-gold-400 transition-colors block font-sans">Liturgisk Kalender</span>
                            </a>
                        </div>

                         <!-- Holy Water Stoup -->
                         <div class="relative group cursor-pointer flex flex-col items-center" id="stoup-trigger">
                            <div class="w-16 h-8 border-b-2 border-r-2 border-l-2 border-gold-500/20 rounded-b-full flex items-center justify-center relative overflow-hidden transition-all duration-500 group-hover:border-gold-500/40 group-hover:shadow-[0_0_20px_rgba(0,200,255,0.1)] bg-gradient-to-b from-transparent to-cyan-900/10">
                                <!-- Water Surface -->
                                <div class="absolute inset-x-2 top-2 bottom-1 bg-cyan-500/5 rounded-b-full"></div>
                                <i class="fa-solid fa-cross text-cyan-500/20 text-[8px]"></i>
                                
                                <!-- Ripple Container -->
                                <div id="ripple-container" class="absolute inset-0 flex items-center justify-center pointer-events-none text-cyan-200"></div>
                            </div>
                            <span class="text-[9px] uppercase tracking-widest text-gray-600 group-hover:text-cyan-500/60 transition-colors mt-2 block opacity-60">Vievand</span>
                             
                             <!-- Floating Text Feedback -->
                             <div id="blessing-text" class="absolute -top-8 left-1/2 -translate-x-1/2 text-gold-200 font-serif italic whitespace-nowrap opacity-0 pointer-events-none transition-all duration-1000 transform translate-y-2 text-sm drop-shadow-[0_0_10px_rgba(255,215,0,0.5)]">
                                "In Nomine Patris..."
                             </div>
                        </div>

                        <!-- Bell Tower Rope -->
                         <div class="relative group cursor-pointer flex flex-col items-center mt-4" id="bell-rope">
                             <!-- rope line -->
                             <div class="h-24 w-0.5 bg-gradient-to-b from-gray-800 to-gold-900/80 origin-top transition-all duration-300 ease-in-out group-hover:h-28" id="rope-line"></div>
                             <!-- rope knot -->
                             <div class="w-2 h-3 bg-gold-900 rounded-b-lg shadow-lg relative z-10 transition-transform duration-300 group-hover:translate-y-4" id="rope-knot"></div>
                             
                             <span class="text-[9px] uppercase tracking-widest text-gray-600 group-hover:text-gold-500/60 transition-colors mt-2 block opacity-60">Angelus</span>
                         </div>
                    </div>

                    <!-- Altar (Visual Centerpiece) -->
                    <div class="relative group cursor-pointer transform hover:scale-105 transition-transform duration-1000">
                        <a href="/shrine/adoration" class="block relative z-10">
                            <div class="absolute inset-0 bg-gold-500/10 blur-[80px] rounded-full animate-pulse-slow"></div>
                            
                            <!-- Crucifix SVG -->
                            <div class="relative drop-shadow-[0_0_35px_rgba(255,215,0,0.3)]">
                                <svg width="100" height="130" viewBox="0 0 24 30" xmlns="http://www.w3.org/2000/svg" class="mx-auto overflow-visible">
                                    <defs>
                                        <linearGradient id="gold-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                                            <stop offset="50%" style="stop-color:#FDB931;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#B8860B;stop-opacity:1" />
                                        </linearGradient>
                                        <filter id="glow">
                                            <feGaussianBlur stdDeviation="0.5" result="coloredBlur"/>
                                            <feMerge>
                                                <feMergeNode in="coloredBlur"/>
                                                <feMergeNode in="SourceGraphic"/>
                                            </feMerge>
                                        </filter>
                                    </defs>
                                    <path d="M10 2 H14 V6 H22 V10 H14 V28 H10 V10 H2 V6 H10 V2 Z" fill="url(#gold-gradient)" opacity="0.9" />
                                    <circle cx="12" cy="7.5" r="1.5" fill="url(#gold-gradient)" />
                                    <path d="M12 9 C 9 9, 4 8, 4 7 C 4 9, 9 11, 12 12 C 15 11, 20 9, 20 7 C 20 8, 15 9, 12 9 Z M 12 12 L 12 22 L 11 26 L 13 26 L 12 22 Z" fill="url(#gold-gradient)" filter="url(#glow)" />
                                    <rect x="11" y="0.5" width="2" height="1.5" fill="url(#gold-gradient)" />
                                </svg>
                            </div>
                             <div class="absolute -bottom-10 left-1/2 -translate-x-1/2 text-[9px] uppercase tracking-[0.3em] text-gold-500/60 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                Adoratio
                            </div>
                        </a>
                    </div>

                    <!-- Choir (Community & Prayer) -->
                    <div class="flex flex-col gap-4 text-center w-full max-w-xs">
                        <a href="/shrine/prayers" class="shrine-card-center group py-6 border-t border-b border-gold-500/10 hover:border-gold-500/30 transition-all">
                            <span class="text-[10px] uppercase tracking-widest text-gold-500/60 block mb-2 font-sans">Communio Sanctorum</span>
                            <h2 class="text-xl text-gold-100 font-serif tracking-wide group-hover:text-white transition-colors">Forb√∏n</h2>
                        </a>
                        <a href="/shrine/candles" class="shrine-card-center group py-6 border-b border-gold-500/10 hover:border-gold-500/30 transition-all">
                            <span class="text-[10px] uppercase tracking-widest text-gold-500/60 block mb-2 font-sans">Capella Lucis</span>
                            <h2 class="text-xl text-gold-100 font-serif flex items-center justify-center gap-3 tracking-wide group-hover:text-white transition-colors">
                                Kapellet <i class="fa-solid fa-fire text-orange-500 text-xs animate-flicker opacity-80"></i>
                            </h2>
                        </a>
                    </div>
                </div>

                <!-- EAST WING (Sacraments / Right) -->
                <div class="col-span-1 flex flex-col gap-8 justify-center items-center md:items-start order-3 animate-fade-in-up" style="animation-delay: 0.4s;">
                    <a href="/shrine/treasury" class="shrine-card group text-center md:text-left w-64 md:w-auto">
                        <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Thesaurus</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Skatkammeret</h2>
                        <p class="text-xs text-gray-500 mt-2 opacity-60 group-hover:opacity-100 transition-opacity italic font-serif">Helgensamling</p>
                    </a>
                    <a href="/shrine/confession" class="shrine-card group text-center md:text-left w-64 md:w-auto">
                        <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Confessionarium</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Skriftem√•l</h2>
                        <p class="text-xs text-gray-500 mt-2 opacity-60 group-hover:opacity-100 transition-opacity italic font-serif">Samvittighedsransagelse</p>
                    </a>
                    <a href="/shrine/rosary" class="shrine-card group text-center md:text-left w-64 md:w-auto">
                        <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Rosarium</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Rosenkransen</h2>
                        <p class="text-xs text-gray-500 mt-2 opacity-60 group-hover:opacity-100 transition-opacity italic font-serif">Mysteriets Have</p>
                    </a>
                    <a href="/shrine/hortus-conclusus" class="shrine-card group text-center md:text-left w-64 md:w-auto">
                         <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Hortus Conclusus</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Jomfruens Have</h2>
                        <p class="text-xs text-gray-500 mt-2 opacity-60 group-hover:opacity-100 transition-opacity italic font-serif">Stilhed & V√¶kst</p>
                    </a>
                    <a href="/shrine/lectio" class="shrine-card group text-center md:text-left w-64 md:w-auto">
                        <span class="text-[10px] uppercase tracking-widest text-gold-500/60 group-hover:text-gold-400 mb-2 block font-sans">Verbum Dei</span>
                        <h2 class="text-2xl text-gold-100 font-serif group-hover:text-white transition-colors">Lectio Divina</h2>
                        <p class="text-xs text-gray-500 mt-2 opacity-60 group-hover:opacity-100 transition-opacity italic font-serif">Dagens Ord</p>
                    </a>
                </div>

            </div>

            <!-- Decorative Arch Lines (Background) -->
            <div class="absolute inset-y-0 left-1/2 -translate-x-1/2 w-px bg-gradient-to-b from-transparent via-gold-500/10 to-transparent pointer-events-none"></div>
            <div class="absolute inset-x-0 top-1/2 -translate-y-1/2 h-px bg-gradient-to-r from-transparent via-gold-500/10 to-transparent pointer-events-none"></div>
        </div>
    
    </div>

    <!-- Hidden Audio Player -->
    <audio id="shrine-audio" loop preload="auto">
        <source src="/assets/audio/chant.mp3" type="audio/mpeg">
    </audio>
    <audio id="bell-audio" preload="auto">
        <source src="/assets/audio/bell.mp3" type="audio/mpeg">
    </audio>

</body>
</html>


<script>
    // Audio Elements
    const audio = document.getElementById('shrine-audio') as HTMLAudioElement;
    const muteBtn = document.getElementById('mute-btn');
    const volIcon = muteBtn?.querySelector('.fa-volume-high');
    const muteIcon = muteBtn?.querySelector('.fa-volume-xmark');
    const playIcon = muteBtn?.querySelector('.fa-play');
    
    // Start Logic on Load
    window.addEventListener('load', async () => {
        // Try Autoplay
        audio.volume = 1.0;
        try {
            await audio.play();
            // Success
            volIcon?.classList.remove('hidden');
            muteIcon?.classList.add('hidden');
            playIcon?.classList.add('hidden');
        } catch (e) {
            console.log("Autoplay blocked. Showing Play button.", e);
            // Fallback
            volIcon?.classList.add('hidden');
            muteIcon?.classList.add('hidden');
            playIcon?.classList.remove('hidden');
            muteBtn?.classList.add('animate-pulse');
        }
    });

    // Mute/Play Control
    muteBtn?.addEventListener('click', async () => {
        if (audio.paused) {
            // Manual Start
            try {
                await audio.play();
                volIcon?.classList.remove('hidden');
                muteIcon?.classList.add('hidden');
                playIcon?.classList.add('hidden');
                muteBtn.classList.remove('animate-pulse');
            } catch(e) { console.error(e); }
        } else {
            // Toggle Mute
            audio.muted = !audio.muted;
            if(audio.muted) {
                volIcon?.classList.add('hidden');
                muteIcon?.classList.remove('hidden');
            } else {
                volIcon?.classList.remove('hidden');
                muteIcon?.classList.add('hidden');
            }
        }
    });

    // Holy Water Stoup
    const stoupTrigger = document.getElementById('stoup-trigger');
    const rippleContainer = document.getElementById('ripple-container');
    const blessingText = document.getElementById('blessing-text');

    stoupTrigger?.addEventListener('click', () => {
        // Create Ripple
        const ripple = document.createElement('div');
        ripple.className = "ripple-effect";
        rippleContainer?.appendChild(ripple);
        
        // Cleanup Ripple
        setTimeout(() => ripple.remove(), 800);

        // Show Text
        if(blessingText) {
            blessingText.classList.remove('opacity-0', 'translate-y-2');
            blessingText.classList.add('opacity-100', 'translate-y-0');
            
            // Hide after 2s
            setTimeout(() => {
                blessingText.classList.remove('opacity-100', 'translate-y-0');
                blessingText.classList.add('opacity-0', 'translate-y-2'); 
            }, 2000);
        }
    });

    // Bell Tower (Angelus)
    const bellRope = document.getElementById('bell-rope');
    const ropeLine = document.getElementById('rope-line');
    const ropeKnot = document.getElementById('rope-knot');
    const bellAudio = document.getElementById('bell-audio');

    function ringBell() {
        // visual pull
        ropeLine?.classList.add('scale-y-[1.2]');
        ropeKnot?.classList.add('translate-y-6');
        setTimeout(() => {
            ropeLine?.classList.remove('scale-y-[1.2]');
            ropeKnot?.classList.remove('translate-y-6');
        }, 300);

        // sound
        if(bellAudio) {
            (bellAudio as HTMLAudioElement).currentTime = 0;
            (bellAudio as HTMLAudioElement).play().catch(e => console.log("Audio ignored", e));
        }
    }

    bellRope?.addEventListener('click', ringBell);

    // Initial Angelus Check
    const now = new Date();
    const h = now.getHours();
    const m = now.getMinutes();
    // 12:00 or 18:00 (6 PM) window (let's say first 2 minutes)
    if((h === 12 || h === 18) && m < 5) {
        // Pulse animation to invite ringing (since we can't auto-play sound mostly)
        bellRope?.classList.add('animate-bounce');
    }
</script>

<style>
    .shrine-card {
        display: block;
        padding: 1.5rem;
        border: 1px solid transparent;
        background: transparent;
        transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        position: relative;
    }
    .shrine-card:hover {
        border-color: rgba(255, 215, 0, 0.1);
        background: rgba(255, 215, 0, 0.02);
        transform: translateX(5px);
    }
    /* Reverse hover for Left side */
    .items-end .shrine-card:hover {
            transform: translateX(-5px);
    }
    
    .shrine-card-center {
        display: block;
        width: 100%;
        background: transparent;
    }
    .shrine-card-center:hover {
        background: rgba(255, 215, 0, 0.03);
        letter-spacing: 0.05em;
    }

    /* KEYFRAMES */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in-up {
        animation: fadeInUp 1.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        opacity: 0;
    }

    .animate-pulse-slow {
        animation: pulse 8s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes smokeRise {
        0% { transform: translateY(0) scale(1); opacity: 0.3; }
        50% { transform: translateY(-30px) scale(1.1); opacity: 0.2; }
        100% { transform: translateY(-60px) scale(1.2); opacity: 0; }
    }
    
    .animate-smoke-rise {
        animation: smokeRise 15s infinite ease-in-out;
    }
    
    .animate-smoke-rise-slow {
        animation: smokeRise 25s infinite ease-in-out reverse;
    }

    @keyframes flicker {
        0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.8; }
        50% { transform: translateX(-50%) scale(1.1); opacity: 1; filter: brightness(1.2); }
        25% { transform: translateX(-52%) scale(0.9); opacity: 0.7; }
        75% { transform: translateX(-48%) scale(1.05); opacity: 0.9; }
    }

    .animate-flicker {
        animation: flicker 0.1s infinite alternate;
    }

    /* RIPPLE */
    @keyframes ripple {
        0% { transform: scale(0); opacity: 0.5; }
        100% { transform: scale(3); opacity: 0; }
    }
    .ripple-effect {
        position: absolute;
        width: 100%;
        height: 100%; /* Fill container */
        background: radial-gradient(circle, rgba(0,255,255,0.2) 0%, transparent 70%);
        border-radius: 50%;
        animation: ripple 0.8s ease-out forwards;
    }
</style>
