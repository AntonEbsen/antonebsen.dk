---
interface Props {
  lang?: 'da' | 'en';
}

const { lang = 'da' } = Astro.props;

const labels = {
  da: {
    profile: "Profil",
    experience: "Erhvervserfaring",
    education: "Uddannelse",
    projects: "Projekter",
    skills: "Kompetencer",
    languages: "Sprog",
    volunteer: "Frivilligt",
    certifications: "Certificeringer",
    discovery: "Udforskning",
    contact: "Kontakt"
  },
  en: {
    profile: "Profile",
    experience: "Experience",
    education: "Education",
    projects: "Projects",
    skills: "Skills",
    languages: "Languages",
    volunteer: "Volunteer",
    certifications: "Certifications",
    discovery: "Discovery",
    contact: "Contact"
  }
};

const t = labels[lang];
---

<aside class="toc" id="toc" aria-label={lang === 'da' ? "Indholdsfortegnelse" : "Table of Contents"}>
  <div class="toc-header">
    <button
      id="tocToggle"
      class="toc-toggle"
      type="button"
      aria-expanded="true"
      aria-controls="tocNav"
      aria-label={lang === 'da' ? "Vis/skjul indholdsfortegnelse" : "Show/hide table of contents"}
      title={lang === 'da' ? "Vis/skjul indholdsfortegnelse" : "Show/hide table of contents"}
    >
      <span class="hamburger" aria-hidden="true"></span>
    </button>
  </div>

  <nav id="tocNav" class="toc-nav">
    <a href="#profile">{t.profile}</a>
    <a href="#experience">{t.experience}</a>
    <a href="#education">{t.education}</a>
    <a href="#projects">{t.projects}</a>
    <a href="#skills">{t.skills}</a>
    <a href="#languages">{t.languages}</a>
    <a href="#volunteer">{t.volunteer}</a>
    <a href="#certifications">{t.certifications}</a>
    <a href="#discovery">{t.discovery}</a>
    <a href="#contact">{t.contact}</a>
  </nav>
</aside>

<script>
  (function () {
    const wrap = document.querySelector(".cv-wrap");
    const btn = document.getElementById("tocToggle");
    const nav = document.getElementById("tocNav");
    
    // Safety check - if we are not on the CV page (or markup changed), exit
    if (!wrap || !btn || !nav) return;

    function applyFromStorage() {
        const collapsed = localStorage.getItem("tocCollapsed") === "1";
        // Toggle the class on wrapper
        wrap?.classList.toggle("is-toc-collapsed", collapsed);
        // Toggle aria-expanded
        btn?.setAttribute("aria-expanded", String(!collapsed));
    }

    btn.addEventListener("click", function () {
        const nowCollapsed = wrap?.classList.toggle("is-toc-collapsed");
        btn?.setAttribute("aria-expanded", String(!nowCollapsed));
        localStorage.setItem("tocCollapsed", nowCollapsed ? "1" : "0");
    });

    document.addEventListener("DOMContentLoaded", applyFromStorage);
    // Also run on astro:page-load if using View Transitions, though basic script handles it for traditional loads
  })();
</script>

