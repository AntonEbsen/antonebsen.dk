
---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Quantum Dashboard | System Metrics">
    <main class="min-h-screen bg-black text-gold-50 p-4 md:p-8 font-mono">
        
        <!-- LOGIN GATE -->
        <div id="login-gate" class="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center p-4">
             <div class="border border-gold-500/30 bg-gray-900/90 p-8 rounded-lg shadow-[0_0_30px_rgba(255,215,0,0.1)] max-w-md w-full text-center">
                <h1 class="text-2xl font-bold mb-2 text-gold-400">System Access</h1>
                <p class="text-sm text-gray-400 mb-6">Restricted Area. Authorized Personnel Only.</p>
                
                <input type="password" id="password-input" placeholder="Enter Access Code" 
                    class="w-full bg-black border border-gray-700 rounded p-3 text-gold-100 focus:border-gold-500 focus:outline-none mb-4 transition-colors" />
                
                <button id="login-btn" class="w-full bg-gold-600 hover:bg-gold-500 text-black font-bold py-3 rounded transition-all hover:shadow-[0_0_15px_rgba(255,215,0,0.4)]">
                    Unlock Dashboard
                </button>
                <p id="error-msg" class="text-red-500 text-xs mt-3 hidden">Access Denied.</p>
             </div>
        </div>

        <!-- DASHBOARD CONTENT (Hidden by default) -->
        <div id="dashboard-content" class="hidden">
            <header class="flex justify-between items-center mb-8 border-b border-gold-500/20 pb-4">
                <div>
                    <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-gold-300 to-amber-600">
                        Quantum Analytics
                    </h1>
                    <p class="text-xs text-gray-500 mt-1">Live Feed :: Database Connection Active</p>
                </div>
                <div class="text-right">
                    <div id="status-dot" class="inline-block w-3 h-3 bg-green-500 rounded-full animate-pulse mr-2"></div>
                    <span class="text-sm text-gold-400">ONLINE</span>
                </div>
            </header>

            <!-- STATUS UPDATER -->
            <div class="mb-8 p-4 border border-gold-500/30 bg-gray-900/40 rounded-lg flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gold-500/10 flex items-center justify-center border border-gold-500/20 text-xl">
                        ‚ö°
                    </div>
                    <div>
                        <h3 class="text-gold-400 font-bold text-sm uppercase tracking-wider">Live Status</h3>
                        <p class="text-xs text-gray-500">Update the 'Now' indicator on the site.</p>
                    </div>
                </div>
                
                <form id="status-form" class="flex gap-2 w-full md:w-auto">
                    <input type="text" id="now-emoji" placeholder="ü§ñ" class="w-12 bg-black border border-gray-700 rounded text-center focus:border-gold-500 text-lg p-2" required />
                    <input type="text" id="now-text" placeholder="What are you doing?" class="flex-1 md:w-80 bg-black border border-gray-700 rounded px-3 py-2 text-sm focus:border-gold-500 text-gray-200" required />
                    <button type="submit" class="bg-gold-500 text-black px-4 rounded hover:bg-gold-400 transition-colors font-bold">
                        SET
                    </button>
                </form>
            </div>

            <!-- QUICK NAV -->
            <div class="flex flex-wrap gap-3 mb-8 sticky top-0 bg-black/95 z-40 py-4 border-b border-gold-900/50 backdrop-blur-md shadow-lg">
                <button onclick="document.getElementById('stats-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-chart-line mr-2"></i>Stats
                </button>
                <button onclick="document.getElementById('library-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-book mr-2"></i>Library
                </button>
                <button onclick="document.getElementById('training-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-dumbbell mr-2"></i>Training
                </button>
                <button onclick="document.getElementById('quotes-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-quote-right mr-2"></i>Quotes
                </button>
                <button onclick="document.getElementById('travel-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-earth-europe mr-2"></i>Travel
                </button>
                <button onclick="document.getElementById('guestbook-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-pen-nib mr-2"></i>G√¶stebog
                </button>
                <button onclick="document.getElementById('projects-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-briefcase mr-2"></i>Portfolio
                </button>
                <button onclick="document.getElementById('skills-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-tree mr-2"></i>Skills
                </button>
                <button onclick="document.getElementById('blog-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-newspaper mr-2"></i>Blog
                </button>
                 <button onclick="document.getElementById('inbox-section').scrollIntoView({behavior: 'smooth'})" class="px-5 py-2 rounded-lg bg-gray-900 border-2 border-gold-500 text-xs font-bold uppercase tracking-wider text-gold-300 shadow-[0_0_10px_rgba(255,215,0,0.15)] hover:bg-gold-500 hover:text-black hover:shadow-[0_0_20px_rgba(255,215,0,0.4)] transition-all transform hover:-translate-y-1">
                    <i class="fa-solid fa-envelope mr-2"></i>Inbox
                </button>
            </div>

            <!-- KEY METRICS ROW -->
            <div id="stats-section" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <!-- ... stats ... -->
                <div class="border border-gray-800 bg-gray-900/50 p-4 rounded hover:border-gold-500/30 transition-colors">
                    <p class="text-gray-500 text-xs uppercase tracking-wider">Total Conversations</p>
                    <p id="metric-total" class="text-4xl font-bold text-gold-100 mt-2">-</p>
                </div>
                 <div class="border border-gray-800 bg-gray-900/50 p-4 rounded hover:border-gold-500/30 transition-colors">
                    <p class="text-gray-500 text-xs uppercase tracking-wider">Top Persona</p>
                    <p id="metric-persona" class="text-2xl font-bold text-gold-100 mt-2">-</p>
                </div>
                 <div class="border border-gray-800 bg-gray-900/50 p-4 rounded hover:border-gold-500/30 transition-colors">
                    <p class="text-gray-500 text-xs uppercase tracking-wider">Top Intent</p>
                    <p id="metric-intent" class="text-2xl font-bold text-gold-100 mt-2">-</p>
                </div>
                 <div class="border border-gray-800 bg-gray-900/50 p-4 rounded hover:border-gold-500/30 transition-colors">
                    <p class="text-gray-500 text-xs uppercase tracking-wider">Today's Traffic</p>
                    <p id="metric-today" class="text-4xl font-bold text-gold-100 mt-2">-</p>
                </div>
            </div>

            <!-- ... CHARTS ROW ... -->
            
            <!-- ... LOGS TABLE ... -->
            
            <!-- INBOX (CRM) -->
            <div id="inbox-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800 flex justify-between items-center">
                    <h3 class="text-gold-400 font-bold"><i class="fa-solid fa-inbox mr-2"></i> Inbox (CRM)</h3>
                    <span id="unread-count" class="bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded-full hidden">0 NEW</span>
                </div>
                <div class="p-0">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-gray-400">
                            <thead class="bg-gray-900/50 text-xs uppercase font-medium text-gray-500">
                                <tr>
                                    <th class="p-4">Status</th>
                                    <th class="p-4">From</th>
                                    <th class="p-4">Message</th>
                                    <th class="p-4">Date</th>
                                    <th class="p-4 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="inbox-list" class="divide-y divide-gray-800">
                                <tr><td colspan="5" class="p-4 text-center">Loading messages...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- RELEASE MANAGER (Changelog) -->
            <div id="changelog-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold"><i class="fa-solid fa-code-branch mr-2"></i> Release Manager</h3>
                </div>
                <div class="p-6">
                     <form id="changelog-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2">
                            <input type="text" id="cl-title" placeholder="Update Title (e.g. Added Dark Mode)" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                        </div>
                        <div>
                            <select id="cl-type" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500">
                                <option value="new">‚ú® New Feature</option>
                                <option value="fix">üêõ Bug Fix</option>
                                <option value="polish">üé® Polish</option>
                                <option value="announcement">üì¢ Announcement</option>
                            </select>
                        </div>
                        <div>
                            <input type="text" id="cl-version" placeholder="Version (e.g. v1.2)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                        </div>
                        <div class="md:col-span-2">
                            <textarea id="cl-desc" placeholder="What changed? Use formatting if needed." rows="3" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500"></textarea>
                        </div>
                        <div class="md:col-span-2">
                             <button type="submit" class="bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold py-2 px-4 rounded w-full hover:from-green-500 hover:to-emerald-500 flex items-center justify-center gap-2">
                                <i class="fa-solid fa-rocket"></i> Publish Release
                            </button>
                        </div>
                     </form>
                </div>
            </div>

            <!-- INBOX -->
            <div id="inbox-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800 flex justify-between items-center">
                    <h3 class="text-gold-400 font-bold"><i class="fa-solid fa-inbox mr-2"></i> Inbox</h3>
                    <button onclick="loadMessages()" class="text-xs text-dim hover:text-white"><i class="fa-solid fa-rotate"></i> Refresh</button>
                </div>
                <div class="p-0">
                    <div id="inbox-list" class="divide-y divide-gray-800 max-h-[300px] overflow-y-auto">
                        <p class="p-6 text-dim text-sm italic">Loading messages...</p>
                    </div>
                </div>
            </div>

            <!-- Q&A MODERATOR -->
            <div id="qa-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800 flex justify-between items-center">
                    <h3 class="text-gold-400 font-bold"><i class="fa-solid fa-comments mr-2"></i> Q&A Moderator</h3>
                    <button onclick="loadQuestions()" class="text-xs text-dim hover:text-white"><i class="fa-solid fa-rotate"></i> Refresh</button>
                </div>
                <div class="p-6">
                    <div id="qa-pending-list" class="space-y-4">
                        <p class="text-dim text-sm italic">Loading pending questions...</p>
                    </div>
                </div>
            </div>

            <!-- PODCAST MANAGER -->
            <div id="podcast-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold"><i class="fa-solid fa-microphone mr-2"></i> Podcast Manager</h3>
                </div>
                <div class="p-6">
                     <form id="podcast-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <input type="text" id="p-title" placeholder="Podcast Title" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                        </div>
                        <div>
                            <input type="text" id="p-host" placeholder="Host / Network" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                        </div>
                        <div>
                            <select id="p-category" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500">
                                <option value="√òkonomi & Finans">√òkonomi & Finans</option>
                                <option value="Tech & Fremtid">Tech & Fremtid</option>
                                <option value="Society & Kultur">Society & Kultur</option>
                                <option value="Historie">Historie</option>
                                <option value="Sport & Tr√¶ning">Sport & Tr√¶ning</option>
                            </select>
                        </div>
                        <div>
                            <input type="number" id="p-rating" placeholder="Rating (1-5)" min="1" max="5" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                        </div>
                        <div class="md:col-span-2">
                             <input type="url" id="p-link" placeholder="Spotify/Apple Link" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                        </div>
                         <div class="md:col-span-2">
                            <textarea id="p-desc" placeholder="Why is it good?" rows="2" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500"></textarea>
                        </div>
                        <div class="md:col-span-2">
                             <button type="submit" class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold py-2 px-4 rounded w-full hover:from-purple-500 hover:to-indigo-500 flex items-center justify-center gap-2">
                                <i class="fa-solid fa-headphones"></i> Add to Collection
                            </button>
                        </div>
                     </form>
                </div>
            </div>

            <!-- CAREER MANAGER -->
            <div id="career-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold"><i class="fa-solid fa-briefcase mr-2"></i> Career Manager</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- EXPERIENCE FORM -->
                    <div class="border-r border-gray-800 pr-0 md:pr-8">
                        <h4 class="text-gray-400 text-sm mb-4 uppercase font-bold">Add Experience</h4>
                        <form id="exp-form" class="space-y-3">
                            <input type="text" id="exp-title" placeholder="Job Title" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <input type="text" id="exp-org" placeholder="Organization" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" id="exp-type" placeholder="Type (e.g. Undervisning)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                                <input type="text" id="exp-loc" placeholder="Location" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            </div>
                            <input type="text" id="exp-period" placeholder="Period (e.g. 2023 - nu)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <textarea id="exp-desc" placeholder="Description (One bullet per line)" rows="3" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500"></textarea>
                            <textarea id="exp-high" placeholder="Highlights (Label: Value per line)" rows="2" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500"></textarea>
                            <button type="submit" class="bg-gray-800 text-white font-bold py-2 px-4 rounded w-full hover:bg-gray-700 border border-gray-700">Add Job</button>
                        </form>
                    </div>

                    <!-- EDUCATION FORM -->
                    <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase font-bold">Add Education</h4>
                        <form id="edu-form" class="space-y-3">
                            <input type="text" id="edu-inst" placeholder="Institution" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <input type="text" id="edu-degree" placeholder="Degree (e.g. cand.oecon)" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <input type="text" id="edu-period" placeholder="Period" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <textarea id="edu-desc" placeholder="General Description" rows="2" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500"></textarea>
                            <textarea id="edu-bullets" placeholder="Key Points (One per line)" rows="3" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500"></textarea>
                            <input type="text" id="edu-tech" placeholder="Technologies (comma separated)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <button type="submit" class="bg-gray-800 text-white font-bold py-2 px-4 rounded w-full hover:bg-gray-700 border border-gray-700">Add Degree</button>
                        </form>
                    </div>

                </div>
            </div>

            <!-- ... GUESTBOOK ... -->
            
            <!-- ... PROJECTS ... -->

            <!-- ... SKILLS ... -->

            <!-- BLOG EDITOR -->
             <div id="blog-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold">Blog Editor</h3>
                </div>
                <!-- ... Form ... -->
                <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-8">
                     <!-- ADD POST FORM (Takes 2/3) -->
                     <div class="md:col-span-2">
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Write Post</h4>
                        <form id="blog-form" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="b-title" placeholder="Post Title" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                                <input type="text" id="b-slug" placeholder="Slug (optional)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            </div>
                            <textarea id="b-excerpt" placeholder="Short Excerpt" rows="2" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500"></textarea>
                            <textarea id="b-content" placeholder="# Markdown Content Here..." required rows="10" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500 font-mono text-sm"></textarea>
                            <div class="flex items-center gap-4">
                                <input type="text" id="b-image" placeholder="Cover Image URL" class="flex-1 bg-black border border-gray-700 p-2 rounded text-gray-200" />
                                <div class="flex items-center gap-2 border border-gray-700 rounded px-3 py-2">
                                     <input type="checkbox" id="b-published" class="accent-gold-500 w-4 h-4" />
                                     <label for="b-published" class="text-gray-400 text-sm">Publish</label>
                                </div>
                            </div>
                            
                            <button type="submit" class="bg-gradient-to-r from-gold-600 to-amber-600 text-black font-bold py-3 px-4 rounded w-full hover:from-gold-500 hover:to-amber-500 transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2 shadow-lg">
                                <i class="fa-solid fa-paper-plane"></i> Save Post
                            </button>
                        </form>
                     </div>

                     <!-- POST LIST (Takes 1/3) -->
                     <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Existing Posts</h4>
                        <ul id="post-list" class="space-y-2 text-sm text-gray-400 max-h-[500px] overflow-y-auto">
                            <li>Loading posts...</li>
                        </ul>
                     </div>
                </div>
            </div>

            <!-- ... CHARTS ROW ... -->
            
            <!-- ... LOGS TABLE ... -->
            
            <!-- ... GUESTBOOK ... -->
            
            <!-- ... PROJECTS ... -->

            <!-- SKILL MANAGER -->
            <div id="skills-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold">Skill Tree Manager</h3>
                </div>
                <!-- ... Form ... -->
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                     <!-- ADD SKILL FORM -->
                     <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Add Skill</h4>
                        <form id="skill-form" class="space-y-4">
                            <input type="text" id="s-name" placeholder="Skill Name" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <select id="s-category" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500">
                                <option value="professional">Professional</option>
                                <option value="programming">Programming</option>
                                <option value="language">Language</option>
                                <option value="focus">Focus Area</option>
                            </select>
                            <input type="text" id="s-icon" placeholder="Icon Class (fa-solid fa-code)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            <div class="flex items-center gap-4">
                                <label class="text-gray-400 text-sm">Proficiency:</label>
                                <input type="range" id="s-proficiency" min="0" max="100" value="50" class="flex-1 accent-gold-500" oninput="document.getElementById('prof-val').innerText = this.value + '%'" />
                                <span id="prof-val" class="text-gold-400 text-sm font-mono w-10">50%</span>
                            </div>
                            <input type="text" id="s-desc" placeholder="Short description" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            
                            <button type="submit" class="bg-gradient-to-r from-gold-600 to-amber-600 text-black font-bold py-3 px-4 rounded w-full hover:from-gold-500 hover:to-amber-500 transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2 shadow-lg">
                                <i class="fa-solid fa-tree"></i> Plant Skill
                            </button>
                        </form>
                     </div>

                     <!-- SKILL LIST -->
                     <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Growing Skills</h4>
                        <ul id="skill-list" class="space-y-2 text-sm text-gray-400 max-h-80 overflow-y-auto">
                            <li>Loading skills...</li>
                        </ul>
                     </div>
                </div>
            </div>

            <!-- ... CHARTS ROW ... -->
            
            <!-- ... LOGS TABLE ... -->
            
            <!-- ... GUESTBOOK ... -->

            <!-- PROJECTS MANAGER -->
            <div id="projects-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold">Project Portfolio Manager</h3>
                </div>
                <!-- ... Form ... -->
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                     <!-- ADD PROJECT FORM -->
                     <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Add Project</h4>
                        <form id="project-form" class="space-y-4">
                            <input type="text" id="p-title" placeholder="Project Title" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <textarea id="p-desc" placeholder="Description (Markdown supported)" required rows="3" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500"></textarea>
                            <input type="text" id="p-tags" placeholder="Tags (e.g. Astro, Tailwind, AI)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="p-url" placeholder="Project URL" class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                                <div class="flex items-center gap-2 border border-gray-700 rounded px-2">
                                     <input type="checkbox" id="p-featured" class="accent-gold-500 w-4 h-4" />
                                     <label for="p-featured" class="text-gray-400 text-sm">Featured</label>
                                </div>
                            </div>
                            <button type="submit" class="bg-gradient-to-r from-gold-600 to-amber-600 text-black font-bold py-3 px-4 rounded w-full hover:from-gold-500 hover:to-amber-500 transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2 shadow-lg">
                                <i class="fa-solid fa-briefcase"></i> Add Project
                            </button>
                        </form>
                     </div>

                     <!-- PROJECT LIST -->
                     <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Existing Projects</h4>
                        <ul id="project-list" class="space-y-2 text-sm text-gray-400 max-h-80 overflow-y-auto">
                            <li>Loading projects...</li>
                        </ul>
                     </div>
                </div>
            </div>

            <!-- ... CHARTS ROW ... -->
            
            <!-- ... LOGS TABLE ... -->

            <!-- GUESTBOOK MODERATOR -->
            <div id="guestbook-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800 flex justify-between items-center">
                    <h3 class="text-gold-400 font-bold">G√¶stebog Administration</h3>
                    <span class="text-xs text-gray-500">APPROVE TO PUBLISH</span>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                     <!-- PENDING QUEUE -->
                     <div>
                        <h4 class="text-red-400 text-sm mb-4 uppercase flex items-center"><i class="fa-solid fa-triangle-exclamation mr-2"></i> Pending Approval</h4>
                        <ul id="gb-pending" class="space-y-4">
                            <li class="text-gray-500 text-sm">Loading queue...</li>
                        </ul>
                     </div>

                     <!-- APPROVED HISTORY -->
                     <div>
                        <h4 class="text-green-400 text-sm mb-4 uppercase flex items-center"><i class="fa-solid fa-check-circle mr-2"></i> Live on Site</h4>
                        <ul id="gb-approved" class="space-y-2 text-sm text-gray-400 max-h-60 overflow-y-auto">
                            <li>Loading history...</li>
                        </ul>
                     </div>
                </div>
            </div>


            <!-- CHARTS ROW -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <!-- Persona Distribution -->
                <div class="border border-gray-800 bg-gray-900/30 p-6 rounded relative min-h-[300px]">
                    <h3 class="text-gold-400 font-bold mb-4 flex items-center">
                        <span class="mr-2 opacity-50">01</span> User Personas
                    </h3>
                    <div class="relative h-64 w-full">
                        <canvas id="personaChart"></canvas>
                    </div>
                </div>

                <!-- Activity Timeline -->
                <div class="border border-gray-800 bg-gray-900/30 p-6 rounded relative min-h-[300px]">
                    <h3 class="text-gold-400 font-bold mb-4 flex items-center">
                        <span class="mr-2 opacity-50">02</span> Traffic Volume
                    </h3>
                     <div class="relative h-64 w-full">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- RECENT LOGS TABLE -->
            <div class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800 flex justify-between items-center">
                    <h3 class="text-gold-400 font-bold">Recent Intercepts</h3>
                    <button id="refresh-btn" class="text-xs border border-gray-700 hover:border-gold-500 px-3 py-1 rounded transition-colors">
                        REFRESH DATA
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-black text-gray-500 uppercase text-xs">
                            <tr>
                                <th class="p-4 font-normal">Time</th>
                                <th class="p-4 font-normal">Persona</th>
                                <th class="p-4 font-normal">User Message</th>
                                <th class="p-4 font-normal">Intent</th>
                            </tr>
                        </thead>
                        <tbody id="logs-body" class="divide-y divide-gray-800/50">
                            <!-- Rows injected by JS -->
                            <tr><td colspan="4" class="p-8 text-center text-gray-600">Loading stream...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- LIBRARY MANAGER -->
             <div id="library-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold">Living Library Manager</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- ADD BOOK FORM -->
                    <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Add New Entry</h4>
                        <form id="book-form" class="space-y-4">
                            <input type="text" id="book-title" placeholder="Book Title" required class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <input type="text" id="book-author" placeholder="Author" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            <div class="grid grid-cols-2 gap-4">
                                <select id="book-status" class="bg-black border border-gray-700 p-2 rounded text-gray-200">
                                    <option value="Reading">Reading</option>
                                    <option value="Finished">Finished</option>
                                    <option value="To Read">To Read</option>
                                </select>
                                <input type="number" id="book-rating" placeholder="Rating (1-5)" min="1" max="5" class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            </div>
                            <button type="submit" class="bg-gradient-to-r from-gold-600 to-amber-600 text-black font-bold py-3 px-4 rounded w-full hover:from-gold-500 hover:to-amber-500 transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2 shadow-lg">
                                <i class="fa-solid fa-plus-circle"></i> Add to Library
                            </button>
                        </form>
                    </div>

                    <!-- BOOK LIST PREVIEW -->
                    <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Recent Additions</h4>
                        <ul id="book-list" class="space-y-2 text-sm text-gray-400">
                            <li>Loading library...</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- WORKOUT LOGGER -->
            <div id="training-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold">Quantified Self (Training)</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- LOG WORKOUT FORM -->
                    <div>
                         <h4 class="text-gray-400 text-sm mb-4 uppercase">Log Session</h4>
                         <form id="training-form" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <input type="date" id="t-date" required class="bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                                <select id="t-type" class="bg-black border border-gray-700 p-2 rounded text-gray-200">
                                    <option value="Strength">Strength (Styrke)</option>
                                    <option value="Running">Running (L√∏b)</option>
                                    <option value="Cycling">Cycling (Cykling)</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-3 gap-2">
                                <input type="number" id="t-duration" placeholder="Mins" class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                                <input type="number" id="t-distance" placeholder="Km" step="0.1" class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                                <input type="number" id="t-tonnage" placeholder="Kg" class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            </div>
                            <input type="text" id="t-notes" placeholder="Notes (e.g. 5x5 Squat PR)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            <button type="submit" class="bg-gradient-to-r from-gold-600 to-amber-600 text-black font-bold py-3 px-4 rounded w-full hover:from-gold-500 hover:to-amber-500 transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2 shadow-lg">
                                <i class="fa-solid fa-person-running"></i> Log Workout
                            </button>
                         </form>
                    </div>

                    <!-- RECENT LOGS -->
                    <div>
                         <h4 class="text-gray-400 text-sm mb-4 uppercase">Recent Logs</h4>
                         <ul id="training-list" class="space-y-2 text-sm text-gray-400">
                            <li>Loading logs...</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- QUOTE BANK -->
            <div id="quotes-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden mb-8 scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold">Quote Bank Manager</h3>
                </div>
                <!-- ... Quote Form ... -->
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                     <!-- ADD QUOTE FORM -->
                     <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Add Wisdom</h4>
                        <form id="quote-form" class="space-y-4">
                            <textarea id="q-text" placeholder="The quote text..." required rows="3" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500"></textarea>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="q-author" placeholder="Author" class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                                <input type="text" id="q-source" placeholder="Source (Book/Paper)" class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            </div>
                            <input type="text" id="q-tags" placeholder="Tags (comma separated)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            <button type="submit" class="bg-gradient-to-r from-gold-600 to-amber-600 text-black font-bold py-3 px-4 rounded w-full hover:from-gold-500 hover:to-amber-500 transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2 shadow-lg">
                                <i class="fa-solid fa-scroll"></i> Add to Bank
                            </button>
                        </form>
                     </div>

                     <!-- RECENT QUOTES -->
                     <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Recent Additions</h4>
                        <ul id="quote-list" class="space-y-2 text-sm text-gray-400">
                            <li>Loading quotes...</li>
                        </ul>
                     </div>
                </div>
            </div>

            <!-- TRAVEL MAP MANAGER -->
            <div id="travel-section" class="border border-gray-800 bg-gray-900/30 rounded overflow-hidden scroll-mt-24">
                <div class="bg-gray-900/80 p-4 border-b border-gray-800">
                    <h3 class="text-gold-400 font-bold">World Map Manager</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                     <!-- ADD LOCATION FORM -->
                     <div>
                        <h4 class="text-gray-400 text-sm mb-4 uppercase">Drop Pin</h4>
                        <form id="travel-form" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="tr-city" placeholder="City" required class="bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                                <input type="text" id="tr-country" placeholder="Country" required class="bg-black border border-gray-700 p-2 rounded text-gray-200 focus:border-gold-500" />
                            </div>
                            <select id="tr-category" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200">
                                <option value="rejser">Rejser / Ferie</option>
                                <option value="hjem">Hjem / Base</option>
                                <option value="studier">Studier</option>
                                <option value="arbejde">Arbejde / Events</option>
                            </select>
                             <div class="grid grid-cols-3 gap-2">
                                <input type="number" id="tr-lat" placeholder="Lat" step="any" required class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                                <input type="number" id="tr-lng" placeholder="Lng" step="any" required class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                                <input type="number" id="tr-year" placeholder="Year" class="bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            </div>
                            <input type="text" id="tr-notes" placeholder="Notes (Memory)" class="w-full bg-black border border-gray-700 p-2 rounded text-gray-200" />
                            <p class="text-xs text-gray-500">Tip: Right-click Google Maps to get Lat/Lng.</p>
                            <button type="submit" class="bg-gradient-to-r from-gold-600 to-amber-600 text-black font-bold py-3 px-4 rounded w-full hover:from-gold-500 hover:to-amber-500 transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2 shadow-lg">
                                <i class="fa-solid fa-map-pin"></i> Add Location
                            </button>
                        </form>
                     </div>

        </div>
    </main>
</Layout>

<script>
    import Chart from 'chart.js/auto';

    // ... (Login Gate Logic same as before) ...
    const CORRECT_CODE = "quantum"; 
    const gate = document.getElementById('login-gate');
    const content = document.getElementById('dashboard-content');
    const input = document.getElementById('password-input') as HTMLInputElement;
    const btn = document.getElementById('login-btn');
    const errorMsg = document.getElementById('error-msg');

    function checkLogin() {
        if (input.value.toLowerCase().trim() === CORRECT_CODE) {
            gate.classList.add('hidden');
            content.classList.remove('hidden');
            loadData(); 
            loadBooks(); 
            loadTraining(); 
            loadQuotes();
            loadTravel();
            loadGuestbook();
            loadProjects();
            loadSkills();
            loadPosts();
            loadInbox();
            loadStatus();
            loadGoals(); // Bucket List
            loadQuestions(); // Q&A
        } else {
            errorMsg.classList.remove('hidden');
            input.classList.add('border-red-500');
        }
    }

    btn?.addEventListener('click', checkLogin);
    input?.addEventListener('keyup', (e) => e.key === 'Enter' && checkLogin());

    // --- LOADERS ---
    async function loadData() { /* ... Stats ... */
        try { const res = await fetch('/api/stats'); const data = await res.json(); if (data.error) throw new Error(data.error); renderMetrics(data); renderCharts(data); renderTable(data.recent); } catch (err) { console.error("Dashboard Error:", err); }
    }
    async function loadBooks() { /* ... Books ... */
        try { const res = await fetch('/api/books'); const books = await res.json(); const list = document.getElementById('book-list')!; list.innerHTML = ''; if(books.length === 0) { list.innerHTML = '<li>No books.</li>'; return; } books.slice(0, 5).forEach((b: any) => { const li = document.createElement('li'); li.className = "border-b border-gray-800 pb-2 flex justify-between"; li.innerHTML = `<span>${b.title}</span> <span class="text-gold-500 text-xs">${b.status}</span>`; list.appendChild(li); }); } catch (err) { console.error(err); }
    }
    async function loadTraining() { /* ... Training ... */
        try { const res = await fetch('/api/training'); const logs = await res.json(); const list = document.getElementById('training-list')!; list.innerHTML = ''; if (logs.length === 0) { list.innerHTML = '<li>No logs found.</li>'; return; } logs.slice(0, 5).forEach((l: any) => { const li = document.createElement('li'); li.className = "border-b border-gray-800 pb-2 flex justify-between items-center"; li.innerHTML = `<div><span class="text-gray-300 block">${l.type}</span><span class="text-xs text-gray-600">${l.date}</span></div><div class="text-right">${l.distance_km ? `<span class="text-gold-500 text-xs block">${l.distance_km} km</span>` : ''}${l.tonnage_kg ? `<span class="text-gold-500 text-xs block">${l.tonnage_kg} kg</span>` : ''}</div>`; list.appendChild(li); }); } catch (err) { console.error(err); }
    }
    async function loadQuotes() { /* ... Quotes ... */
        try { const res = await fetch('/api/quotes'); const quotes = await res.json(); const list = document.getElementById('quote-list')!; list.innerHTML = ''; if (quotes.length === 0) { list.innerHTML = '<li>No quotes found.</li>'; return; } quotes.slice(0, 5).forEach((q: any) => { const li = document.createElement('li'); li.className = "border-b border-gray-800 pb-2"; li.innerHTML = `<p class="italic">"${q.text.substring(0, 40)}${q.text.length > 40 ? '...' : ''}"</p><span class="text-gold-500 text-xs">- ${q.author || 'Unknown'}</span>`; list.appendChild(li); }); } catch (err) { console.error(err); }
    }

    // --- GUESTBOOK LOGIC ---
    async function loadGuestbook() {
        try {
            const res = await fetch('/api/guestbook?all=true');
            const msgs = await res.json();
            
            const pendingList = document.getElementById('gb-pending')!;
            const approvedList = document.getElementById('gb-approved')!;
            
            pendingList.innerHTML = '';
            approvedList.innerHTML = '';

            const pending = msgs.filter((m:any) => !m.approved);
            const approved = msgs.filter((m:any) => m.approved);

            // Render Pending
            if (pending.length === 0) {
                pendingList.innerHTML = '<li class="text-gray-600 italic">Ingen ventende beskeder.</li>';
            } else {
                pending.forEach((m:any) => {
                    const li = document.createElement('li');
                    li.className = "bg-black/50 p-3 rounded border border-gray-800";
                    li.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-bold text-gold-300 font-mono">${m.name}</span>
                            <span class="text-xs text-gray-600">${new Date(m.created_at).toLocaleDateString()}</span>
                        </div>
                        <p class="text-gray-300 text-sm mb-3 font-serif">"${m.message}"</p>
                        <div class="flex gap-2">
                            <button onclick="updateGuestbook(${m.id}, 'approve')" class="flex-1 bg-green-900/30 border border-green-800 hover:bg-green-600 text-green-400 hover:text-black py-1 rounded text-xs transition-colors">Godkend</button>
                            <button onclick="updateGuestbook(${m.id}, 'delete')" class="flex-1 bg-red-900/30 border border-red-800 hover:bg-red-600 text-red-400 hover:text-black py-1 rounded text-xs transition-colors">Slet</button>
                        </div>
                    `;
                    pendingList.appendChild(li);
                });
            }

            // Render Approved
            if (approved.length === 0) {
                approvedList.innerHTML = '<li class="text-gray-600 italic">G√¶stebogen er tom.</li>';
            } else {
                approved.forEach((m:any) => {
                    const li = document.createElement('li');
                    li.className = "border-b border-gray-800 pb-1 flex justify-between";
                    li.innerHTML = `
                        <span>${m.name}: <span class="italic text-gray-500 truncate max-w-[150px] inline-block align-bottom">"${m.message}"</span></span>
                        <button onclick="updateGuestbook(${m.id}, 'delete')" class="text-red-500 hover:text-red-400 text-xs ml-2">[x]</button>
                    `;
                    approvedList.appendChild(li);
                });
            }

        } catch (err) { console.error(err); }
    }

    // Expose to window for onclick handlers
    (window as any).updateGuestbook = async (id: number, action: 'approve'|'delete') => {
        if (!confirm(`Are you sure you want to ${action}?`)) return;
        
        await fetch('/api/guestbook', {
            method: 'PUT',
            body: JSON.stringify({ id, action })
        });
        loadGuestbook();
    };

    // --- PROJECTS LOGIC ---
    async function loadProjects() {
        try {
            const res = await fetch('/api/projects');
            const data = await res.json();
            const list = document.getElementById('project-list')!;
            
            list.innerHTML = '';
            if (data.length === 0) {
                list.innerHTML = '<li>No projects found.</li>';
                return;
            }

            data.forEach((p: any) => {
                const li = document.createElement('li');
                li.className = "bg-black/50 p-3 rounded border border-gray-800 flex justify-between items-center group hover:border-gold-500/50 transition-colors";
                li.innerHTML = `
                    <div>
                        <div class="flex items-center gap-2">
                             <span class="font-bold text-gray-200">${p.title}</span>
                             ${p.featured ? '<span class="text-[10px] bg-gold-500/20 text-gold-400 px-1 rounded uppercase tracking-wider border border-gold-500/30">Detailed</span>' : ''}
                        </div>
                        <p class="text-xs text-gray-500 truncate max-w-[200px]">${p.tags ? p.tags.join(', ') : ''}</p>
                    </div>
                    <button onclick="deleteProject(${p.id})" class="text-red-500 hover:text-red-300 opacity-0 group-hover:opacity-100 transition-opacity">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                `;
                list.appendChild(li);
            });
        } catch (err) { console.error(err); }
    }

    document.getElementById('project-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const title = (document.getElementById('p-title') as HTMLInputElement).value;
        const description = (document.getElementById('p-desc') as HTMLTextAreaElement).value;
        const tagsRaw = (document.getElementById('p-tags') as HTMLInputElement).value;
        const url = (document.getElementById('p-url') as HTMLInputElement).value;
        const featured = (document.getElementById('p-featured') as HTMLInputElement).checked;

        const tags = tagsRaw.split(',').map(t => t.trim()).filter(Boolean);

        await fetch('/api/projects', {
            method: 'POST',
            body: JSON.stringify({ title, description, tags, url, featured })
        });
        
        (e.target as HTMLFormElement).reset();
        loadProjects();
    });

    (window as any).deleteProject = async (id: number) => {
        if (!confirm('Delete this project?')) return;
        await fetch(`/api/projects?id=${id}`, { method: 'DELETE' });
        loadProjects();
    };

    // --- SKILLS LOGIC ---
    async function loadSkills() {
        try {
            const res = await fetch('/api/skills');
            const data = await res.json();
            const list = document.getElementById('skill-list')!;
            
            list.innerHTML = '';
            if (data.length === 0) {
                list.innerHTML = '<li>No skills found.</li>';
                return;
            }

            data.forEach((s: any) => {
                const li = document.createElement('li');
                li.className = "bg-black/50 p-2 rounded border border-gray-800 flex justify-between items-center group hover:border-gold-500/50 transition-colors";
                li.innerHTML = `
                    <div class="flex items-center gap-3">
                         <div class="w-8 h-8 rounded bg-gray-900 flex items-center justify-center text-gold-500">
                            <i class="${s.icon || 'fa-solid fa-star'}"></i>
                         </div>
                         <div>
                            <p class="font-bold text-gray-200 text-xs">${s.name}</p>
                            <div class="w-24 h-1 bg-gray-800 rounded-full mt-1 overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-gold-600 to-amber-500" style="width: ${s.proficiency}%"></div>
                            </div>
                         </div>
                    </div>
                    <button onclick="deleteSkill(${s.id})" class="text-red-500 hover:text-red-300 opacity-0 group-hover:opacity-100 transition-opacity text-xs">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                `;
                list.appendChild(li);
            });
        } catch (err) { console.error(err); }
    }

    document.getElementById('skill-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = (document.getElementById('s-name') as HTMLInputElement).value;
        const category = (document.getElementById('s-category') as HTMLSelectElement).value;
        const icon = (document.getElementById('s-icon') as HTMLInputElement).value;
        const proficiency = (document.getElementById('s-proficiency') as HTMLInputElement).value;
        const description = (document.getElementById('s-desc') as HTMLInputElement).value;

        await fetch('/api/skills', {
            method: 'POST',
            body: JSON.stringify({ name, category, icon, proficiency: parseInt(proficiency), description })
        });
        
        (e.target as HTMLFormElement).reset();
        document.getElementById('prof-val')!.innerText = "50%";
        loadSkills();
    });

    (window as any).deleteSkill = async (id: number) => {
        if (!confirm('Prune this skill?')) return;
        await fetch(`/api/skills?id=${id}`, { method: 'DELETE' });
        loadSkills();
    };

    // --- BLOG LOGIC ---
    async function loadPosts() {
        try {
            const res = await fetch('/api/posts');
            const data = await res.json();
            const list = document.getElementById('post-list')!;
            
            list.innerHTML = '';
            if (data.length === 0) {
                list.innerHTML = '<li>No posts found.</li>';
                return;
            }

            data.forEach((p: any) => {
                const li = document.createElement('li');
                li.className = "bg-black/50 p-3 rounded border border-gray-800 flex justify-between items-center group hover:border-gold-500/50 transition-colors";
                li.innerHTML = `
                    <div>
                        <div class="flex items-center gap-2">
                             <span class="font-bold text-gray-200 text-sm">${p.title}</span>
                             ${p.published ? '<i class="fa-solid fa-circle text-[8px] text-green-500"></i>' : '<i class="fa-solid fa-circle text-[8px] text-gray-600"></i>'}
                        </div>
                        <p class="text-xs text-gray-500 truncate max-w-[150px]">${new Date(p.created_at).toLocaleDateString()}</p>
                    </div>
                    <button onclick="deletePost(${p.id})" class="text-red-500 hover:text-red-300 opacity-0 group-hover:opacity-100 transition-opacity text-xs">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                `;
                list.appendChild(li);
            });
        } catch (err) { console.error(err); }
    }

    document.getElementById('blog-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const title = (document.getElementById('b-title') as HTMLInputElement).value;
        const slug = (document.getElementById('b-slug') as HTMLInputElement).value;
        const excerpt = (document.getElementById('b-excerpt') as HTMLInputElement).value;
        const content = (document.getElementById('b-content') as HTMLInputElement).value;
        const image_url = (document.getElementById('b-image') as HTMLInputElement).value;
        const published = (document.getElementById('b-published') as HTMLInputElement).checked;

        await fetch('/api/posts', {
            method: 'POST',
            body: JSON.stringify({ title, slug, excerpt, content, image_url, published })
        });
        
        (e.target as HTMLFormElement).reset();
        loadPosts();
    });

    (window as any).deletePost = async (id: number) => {
        if (!confirm('Delete this post?')) return;
        await fetch(`/api/posts?id=${id}`, { method: 'DELETE' });
        loadPosts();
    };

    // --- NOW STATUS LOGIC ---
    async function loadStatus() {
        try {
            const res = await fetch('/api/now');
            const data = await res.json();
            if (data) {
                (document.getElementById('now-emoji') as HTMLInputElement).value = data.emoji;
                (document.getElementById('now-text') as HTMLInputElement).value = data.status;
            }
        } catch (err) { console.error(err); }
    }

    document.getElementById('status-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const emoji = (document.getElementById('now-emoji') as HTMLInputElement).value;
        const status = (document.getElementById('now-text') as HTMLInputElement).value;
        
        const btn = (e.target as HTMLFormElement).querySelector('button')!;
        const icon = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

        await fetch('/api/now', {
            method: 'POST',
            body: JSON.stringify({ emoji, status })
        });
        
        btn.innerHTML = icon;
        // Visual feedback
        btn.classList.add('bg-green-500', 'text-white');
        setTimeout(() => btn.classList.remove('bg-green-500', 'text-white'), 1000);
    });

    // --- INBOX LOGIC ---
    async function loadInbox() {
        try {
            const res = await fetch('/api/contact');
            const data = await res.json();
            const list = document.getElementById('inbox-list')!;
            const badge = document.getElementById('unread-count')!;
            
            list.innerHTML = '';
            if (data.length === 0) {
                list.innerHTML = '<tr><td colspan="5" class="p-4 text-center">No messages.</td></tr>';
                badge.classList.add('hidden');
                return;
            }

            const unread = data.filter((m: any) => !m.read).length;
            if (unread > 0) {
                badge.innerText = `${unread} NEW`;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }

            data.forEach((m: any) => {
                const tr = document.createElement('tr');
                tr.className = m.read ? "bg-transparent opacity-50 hover:opacity-100 transition-opacity" : "bg-gold-500/5 font-medium";
                tr.innerHTML = `
                    <td class="p-4">
                        ${m.read ? '<i class="fa-regular fa-envelope-open text-gray-600"></i>' : '<i class="fa-solid fa-envelope text-gold-500"></i>'}
                    </td>
                    <td class="p-4">
                        <div class="text-gray-200">${m.name}</div>
                        <div class="text-[10px] text-gray-500">${m.email}</div>
                    </td>
                    <td class="p-4 max-w-xs truncate" title="${m.message}">
                        ${m.message}
                    </td>
                    <td class="p-4 text-xs text-gray-500">
                         ${new Date(m.created_at).toLocaleDateString()}
                    </td>
                    <td class="p-4 text-right">
                        <button onclick="toggleRead(${m.id}, ${!m.read})" class="text-xs border border-gray-700 px-2 py-1 rounded hover:bg-gray-800">
                            ${m.read ? 'Mark Unread' : 'Mark Read'}
                        </button>
                         <a href="mailto:${m.email}" class="ml-2 text-xs border border-gray-700 px-2 py-1 rounded hover:bg-gray-800">
                           Reply
                        </a>
                    </td>
                `;
                list.appendChild(tr);
            });
        } catch (err) { console.error(err); }
    }

    (window as any).toggleRead = async (id: number, read: boolean) => {
        await fetch('/api/contact', {
            method: 'PUT',
            body: JSON.stringify({ id, read })
        });
        loadInbox();
    };

    // --- TRAVEL LOGIC ---
    // --- GOAL LOGIC ---
    async function loadGoals() {
        try {
            const res = await fetch('/api/bucketlist');
            const data = await res.json();
            
            const todo = document.getElementById('list-todo')!;
            const doing = document.getElementById('list-doing')!;
            const done = document.getElementById('list-done')!;
            
            todo.innerHTML = ''; doing.innerHTML = ''; done.innerHTML = '';

            data.forEach((g: any) => {
                const li = document.createElement('li');
                li.className = "bg-black p-2 rounded border border-gray-800 text-xs shadow-sm";
                
                let btns = '';
                if (g.status === 'todo') {
                    btns = `<button onclick="updateGoal(${g.id}, 'doing')" class="text-blue-500 hover:text-blue-400 ml-auto"><i class="fa-solid fa-play"></i></button>`;
                } else if (g.status === 'doing') {
                    btns = `
                        <button onclick="updateGoal(${g.id}, 'todo')" class="text-gray-500 hover:text-gray-400 mr-2"><i class="fa-solid fa-backward"></i></button>
                        <button onclick="updateGoal(${g.id}, 'done')" class="text-green-500 hover:text-green-400"><i class="fa-solid fa-check"></i></button>
                    `;
                } else {
                    btns = `<button onclick="updateGoal(${g.id}, 'doing')" class="text-gray-500 hover:text-gray-400 ml-auto"><i class="fa-solid fa-rotate-left"></i></button>`;
                }

                li.innerHTML = `
                    <div class="flex justify-between items-start">
                        <span class="text-gray-300 font-medium">${g.title}</span>
                        <div class="flex">${btns}</div>
                    </div>
                `;

                if (g.status === 'todo') todo.appendChild(li);
                if (g.status === 'doing') doing.appendChild(li);
                if (g.status === 'done') done.appendChild(li);
            });
        } catch (err) { console.error(err); }
    }

    (window as any).updateGoal = async (id: number, status: string) => {
        await fetch('/api/bucketlist', {
            method: 'PUT',
            body: JSON.stringify({ id, status })
        });
        loadGoals();
    };

    document.getElementById('goal-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const title = (document.getElementById('g-title') as HTMLInputElement).value;
        const description = (document.getElementById('g-desc') as HTMLInputElement).value;
        const image_url = (document.getElementById('g-image') as HTMLInputElement).value;

        await fetch('/api/bucketlist', {
            method: 'POST',
            body: JSON.stringify({ title, description, image_url })
        });
        
        (e.target as HTMLFormElement).reset();
        loadGoals();
    });
    // --- TRAVEL LOGIC ---
    // --- CHANGELOG LOGIC ---
    document.getElementById('changelog-form')?.addEventListener('submit', async (e) => {
        // ... (existing changelog logic)
        e.preventDefault();
        const title = (document.getElementById('cl-title') as HTMLInputElement).value;
        const type = (document.getElementById('cl-type') as HTMLInputElement).value;
        const version = (document.getElementById('cl-version') as HTMLInputElement).value;
        const description = (document.getElementById('cl-desc') as HTMLInputElement).value;

        const btn = (e.target as HTMLFormElement).querySelector('button')!;
        const icon = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

        await fetch('/api/changelog', {
            method: 'POST',
            body: JSON.stringify({ title, type, version, description })
        });
        
        (e.target as HTMLFormElement).reset();
        btn.innerHTML = icon;
        // visual success
        btn.classList.add('bg-green-400', 'text-black');
        setTimeout(() => btn.classList.remove('bg-green-400', 'text-black'), 1000);
    });

    // --- Q&A LOGIC ---
    async function loadQuestions() {
        try {
            const res = await fetch('/api/qa?admin=true');
            const data = await res.json();
            const list = document.getElementById('qa-pending-list')!;
            list.innerHTML = '';
            
            const pending = data.filter((q:any) => q.status === 'pending');

            if (pending.length === 0) {
                list.innerHTML = '<p class="text-dim text-sm italic">No pending questions.</p>';
                return;
            }

            pending.forEach((q:any) => {
                const div = document.createElement('div');
                div.className = "bg-black border border-gray-800 p-4 rounded mb-4";
                div.innerHTML = `
                    <p class="text-gray-300 font-bold mb-2">"${q.question}"</p>
                    <p class="text-xs text-dim mb-3">Asked by: ${q.asker_name} ‚Ä¢ ${new Date(q.created_at).toLocaleDateString()}</p>
                    <textarea id="ans-${q.id}" rows="2" placeholder="Write answer..." class="w-full bg-gray-900 border border-gray-700 p-2 rounded text-sm text-gray-200 mb-2 focus:border-gold-500"></textarea>
                    <button onclick="publishAnswer(${q.id})" class="text-xs bg-gold-600 text-black px-3 py-1.5 rounded font-bold hover:bg-gold-500">
                        Publish Answer
                    </button>
                    <button onclick="hideQuestion(${q.id})" class="text-xs text-red-400 ml-2 hover:text-red-300">Archive</button>
                `;
                list.appendChild(div);
            });
        } catch (err) { console.error(err); }
    }

    (window as any).publishAnswer = async (id: number) => {
        const answer = (document.getElementById(`ans-${id}`) as HTMLTextAreaElement).value;
        if (!answer) return alert("Write an answer!");
        
        await fetch('/api/qa', {
            method: 'PUT',
            body: JSON.stringify({ id, answer, status: 'answered' })
        });
        loadQuestions();
    };

    (window as any).hideQuestion = async (id: number) => {
        if (!confirm("Are you sure?")) return;
        await fetch('/api/qa', {
            method: 'PUT',
            body: JSON.stringify({ id, status: 'hidden' })
        });
        loadQuestions();
    };

    // --- PODCAST LOGIC ---
    document.getElementById('podcast-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const title = (document.getElementById('p-title') as HTMLInputElement).value;
        const host = (document.getElementById('p-host') as HTMLInputElement).value;
        const category = (document.getElementById('p-category') as HTMLSelectElement).value;
        const rating = (document.getElementById('p-rating') as HTMLInputElement).value;
        const link = (document.getElementById('p-link') as HTMLInputElement).value;
        const description = (document.getElementById('p-desc') as HTMLTextAreaElement).value;

        const btn = (e.target as HTMLFormElement).querySelector('button')!;
        const icon = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

        await fetch('/api/podcasts', {
            method: 'POST',
            body: JSON.stringify({ 
                title, host, category, link, description,
                rating: rating ? parseInt(rating) : 5 
            })
        });
        
        (e.target as HTMLFormElement).reset();
        btn.innerHTML = icon;
        // visual success
        btn.classList.add('bg-green-400', 'text-black');
        setTimeout(() => btn.classList.remove('bg-green-400', 'text-black'), 1000);
    });

    // --- SKILL LOGIC ---
    document.getElementById('skill-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = (document.getElementById('s-name') as HTMLInputElement).value;
        const category = (document.getElementById('s-category') as HTMLSelectElement).value;
        const icon = (document.getElementById('s-icon') as HTMLInputElement).value;
        const proficiency = (document.getElementById('s-prof') as HTMLInputElement).value;
        const description = (document.getElementById('s-desc') as HTMLInputElement).value;

        const btn = (e.target as HTMLFormElement).querySelector('button')!;
        const iconHTML = btn.innerHTML;
        btn.innerHTML = '...';

        await fetch('/api/skills', {
            method: 'POST',
            body: JSON.stringify({ name, category, icon, proficiency: parseInt(proficiency), description })
        });
        
        (e.target as HTMLFormElement).reset();
        btn.innerHTML = iconHTML;
        alert("Skill Added!");
    });

    // --- CAREER LOGIC ---
    document.getElementById('exp-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const title = (document.getElementById('exp-title') as HTMLInputElement).value;
        const organization = (document.getElementById('exp-org') as HTMLInputElement).value;
        const type = (document.getElementById('exp-type') as HTMLInputElement).value;
        const location = (document.getElementById('exp-loc') as HTMLInputElement).value;
        const period = (document.getElementById('exp-period') as HTMLInputElement).value;
        
        const descRaw = (document.getElementById('exp-desc') as HTMLTextAreaElement).value;
        const description = descRaw.split('\n').filter(l => l.trim().length > 0);

        const highRaw = (document.getElementById('exp-high') as HTMLTextAreaElement).value;
        const highlights = highRaw.split('\n').filter(l => l.trim().length > 0).map(l => {
            const parts = l.split(':');
            return { label: parts[0]?.trim(), value: parts.slice(1).join(':').trim() };
        });

        const btn = (e.target as HTMLFormElement).querySelector('button')!;
        const icon = btn.innerHTML;
        btn.innerHTML = '...';

        await fetch('/api/cv/experience', {
            method: 'POST',
            body: JSON.stringify({ title, organization, type, location, period, description, highlights })
        });
        
        (e.target as HTMLFormElement).reset();
        btn.innerHTML = icon;
        alert("Experience Added!");
    });

    document.getElementById('edu-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const institution = (document.getElementById('edu-inst') as HTMLInputElement).value;
        const degree = (document.getElementById('edu-degree') as HTMLInputElement).value;
        const period = (document.getElementById('edu-period') as HTMLInputElement).value;
        const description = (document.getElementById('edu-desc') as HTMLInputElement).value;
        
        const bulletsRaw = (document.getElementById('edu-bullets') as HTMLTextAreaElement).value;
        const bullets = bulletsRaw.split('\n').filter(l => l.trim().length > 0);

        const techRaw = (document.getElementById('edu-tech') as HTMLInputElement).value;
        const technologies = techRaw.split(',').map(t => t.trim()).filter(t => t.length > 0);

        const btn = (e.target as HTMLFormElement).querySelector('button')!;
        const icon = btn.innerHTML;
        btn.innerHTML = '...';

        await fetch('/api/cv/education', {
            method: 'POST',
            body: JSON.stringify({ institution, degree, period, description, bullets, technologies })
        });
        
        (e.target as HTMLFormElement).reset();
        btn.innerHTML = icon;
        alert("Education Added!");
    });

    // --- CERTIFICATION LOGIC ---
    document.getElementById('cert-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = (document.getElementById('c-name') as HTMLInputElement).value;
        const issuer = (document.getElementById('c-issuer') as HTMLInputElement).value;
        const category = (document.getElementById('c-category') as HTMLSelectElement).value;
        const year = (document.getElementById('c-year') as HTMLInputElement).value;
        const url = (document.getElementById('c-link') as HTMLInputElement).value;
        const image_url = (document.getElementById('c-image') as HTMLInputElement).value;
        const description = (document.getElementById('c-desc') as HTMLInputElement).value;

        const btn = (e.target as HTMLFormElement).querySelector('button')!;
        const icon = btn.innerHTML;
        btn.innerHTML = '...';

        await fetch('/api/certifications', {
            method: 'POST',
            body: JSON.stringify({ name, issuer, category, year, url, image_url, description })
        });
        
        (e.target as HTMLFormElement).reset();
        btn.innerHTML = icon;
        alert("Certificate Added!");
    });

    async function loadTravel() {
        try {
            const res = await fetch('/api/travel');
            const locs = await res.json();
            const list = document.getElementById('travel-list')!;
            list.innerHTML = '';

            if (locs.length === 0) { list.innerHTML = '<li>No locations found.</li>'; return; }

            locs.slice(0, 5).forEach((l: any) => {
                const li = document.createElement('li');
                li.className = "border-b border-gray-800 pb-2 flex justify-between";
                li.innerHTML = `<span>${l.city}, ${l.country}</span> <span class="text-gray-500 text-xs">${l.year || ''}</span>`;
                list.appendChild(li);
            });
        } catch (err) { console.error(err); }
    }

    document.getElementById('travel-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const city = (document.getElementById('tr-city') as HTMLInputElement).value;
        const country = (document.getElementById('tr-country') as HTMLInputElement).value;
        const category = (document.getElementById('tr-category') as HTMLSelectElement).value;
        const lat = (document.getElementById('tr-lat') as HTMLInputElement).value;
        const lng = (document.getElementById('tr-lng') as HTMLInputElement).value;
        const year = (document.getElementById('tr-year') as HTMLInputElement).value;
        const notes = (document.getElementById('tr-notes') as HTMLInputElement).value;

        await fetch('/api/travel', {
            method: 'POST',
            body: JSON.stringify({ 
                city, country, category, lat: parseFloat(lat), lng: parseFloat(lng), year: year ? parseInt(year) : null, notes 
            })
        });

        alert("Location Pinned!");
        (e.target as HTMLFormElement).reset();
        loadTravel();
    });

    // --- SUBMIT HANDLERS (Previous) ---
    document.getElementById('quote-form')?.addEventListener('submit', async (e) => {
        // ... (Quote Submit Logic) ...
        e.preventDefault();
        const text = (document.getElementById('q-text') as HTMLTextAreaElement).value;
        const author = (document.getElementById('q-author') as HTMLInputElement).value;
        const source = (document.getElementById('q-source') as HTMLInputElement).value;
        const tags = (document.getElementById('q-tags') as HTMLInputElement).value;

        await fetch('/api/quotes', {
            method: 'POST',
            body: JSON.stringify({ 
                text, author, source, tags: tags ? tags.split(',').map(t => t.trim()) : [] 
            })
        });
        alert("Quote Added!");
        (e.target as HTMLFormElement).reset();
        loadQuotes();
    });

    document.getElementById('training-form')?.addEventListener('submit', async (e) => {
        // ... (Training Submit Logic) ...
        e.preventDefault();
        const date = (document.getElementById('t-date') as HTMLInputElement).value;
        const type = (document.getElementById('t-type') as HTMLSelectElement).value;
        const duration = (document.getElementById('t-duration') as HTMLInputElement).value;
        const distance = (document.getElementById('t-distance') as HTMLInputElement).value;
        const tonnage = (document.getElementById('t-tonnage') as HTMLInputElement).value;
        const notes = (document.getElementById('t-notes') as HTMLInputElement).value;

        await fetch('/api/training', {
            method: 'POST',
            body: JSON.stringify({
                date,
                type,
                duration_min: duration ? parseInt(duration) : null,
                distance_km: distance ? parseFloat(distance) : null,
                tonnage_kg: tonnage ? parseInt(tonnage) : null,
                notes
            })
        });
        alert("Workout Logged!");
        (e.target as HTMLFormElement).reset();
        loadTraining();
    });

    document.getElementById('book-form')?.addEventListener('submit', async (e) => {
        // ... (Book Submit Logic) ...
        e.preventDefault();
        const title = (document.getElementById('book-title') as HTMLInputElement).value;
        const author = (document.getElementById('book-author') as HTMLInputElement).value;
        const status = (document.getElementById('book-status') as HTMLSelectElement).value;
        const rating = (document.getElementById('book-rating') as HTMLInputElement).value;

        await fetch('/api/books', {
            method: 'POST',
            body: JSON.stringify({ title, author, status, rating: rating ? parseInt(rating) : null })
        });
        alert("Book Added!");
        (e.target as HTMLFormElement).reset();
        loadBooks();
    });




    // ... (Charts Render Logic same as before) ...
    document.getElementById('refresh-btn')?.addEventListener('click', loadData);

    // 3. Render Functions
    function renderMetrics(data: any) {
        document.getElementById('metric-total')!.textContent = data.total;
        
        // Find Top Persona
        const topPersona = Object.entries(data.personas).sort((a:any,b:any) => b[1] - a[1])[0];
        document.getElementById('metric-persona')!.textContent = topPersona ? topPersona[0] : 'None';

        // Find Top Intent
        const topIntent = Object.entries(data.intents).sort((a:any,b:any) => b[1] - a[1])[0];
        document.getElementById('metric-intent')!.textContent = topIntent ? topIntent[0] : 'None';

        // Today's traffic
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('metric-today')!.textContent = data.activity[today] || '0';
    }

    let pChart: any = null;
    let aChart: any = null;

    function renderCharts(data: any) {
        const ctxP = document.getElementById('personaChart') as HTMLCanvasElement;
        const ctxA = document.getElementById('activityChart') as HTMLCanvasElement;

        // Destroy old if exists
        if (pChart) pChart.destroy();
        if (aChart) aChart.destroy();

        // Persona Pie Chart
        pChart = new Chart(ctxP, {
            type: 'doughnut',
            data: {
                labels: Object.keys(data.personas),
                datasets: [{
                    data: Object.values(data.personas),
                    backgroundColor: ['#FFD700', '#D97706', '#9CA3AF', '#4B5563', '#1F2937'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right', labels: { color: '#9CA3AF', font: { family: 'monospace' } } }
                }
            }
        });

        // Activity Line Chart
        const dates = Object.keys(data.activity).sort();
        const counts = dates.map(d => data.activity[d]);

        aChart = new Chart(ctxA, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Messages',
                    data: counts,
                    borderColor: '#FFD700',
                    backgroundColor: 'rgba(255, 215, 0, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { grid: { color: '#374151' }, ticks: { color: '#9CA3AF' } },
                    x: { grid: { display: false }, ticks: { color: '#9CA3AF' } }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

    function renderTable(logs: any[]) {
        const tbody = document.getElementById('logs-body')!;
        tbody.innerHTML = '';

        logs.forEach(log => {
            const row = document.createElement('tr');
            row.className = "hover:bg-gray-800/50 transition-colors border-b border-gray-800/50";
            
            const time = new Date(log.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            row.innerHTML = `
                <td class="p-4 text-gray-500 font-mono text-xs">${time}</td>
                <td class="p-4">
                    <span class="bg-gray-800 text-gold-400 px-2 py-1 rounded text-xs border border-gold-500/20 uppercase tracking-widest">
                        ${log.persona || 'DEFAULT'}
                    </span>
                </td>
                <td class="p-4 text-gray-300 truncate max-w-xs" title="${log.user_message}">${log.user_message}</td>
                <td class="p-4">
                     <span class="text-xs text-gray-500 bg-gray-900 border border-gray-700 px-2 py-0.5 rounded">
                        ${log.intent || 'Unknown'}
                    </span>
                </td>
            `;
            tbody.appendChild(row);
        });
    }
</script>
