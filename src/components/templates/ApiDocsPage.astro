---
import Layout from '@layouts/BaseLayout.astro';
import Section from '@components/ui/Section.astro';
import Card from '@components/ui/Card.astro';
import SectionHeading from '@components/ui/SectionHeading.astro';

interface Props {
  lang: 'da' | 'en';
}

const { lang } = Astro.props;
const isDa = lang === 'da';

const content = {
  da: {
    title: "API Dokumentation | Anton Meier Ebsen Jørgensen",
    description: "Dokumentation for de offentlige og interne API-endpoints på antonebsen.dk.",
    heroTitle: "The Protocol",
    heroText: "Velkommen til developer-portalen. Her finder du specifikationer for de endpoints, der driver mine interaktive systemer.",
    endpoints: [
      {
        path: "/api/chat",
        method: "POST",
        description: "Interface til AI Concierge med streaming-support.",
        params: ["message: string", "lang: 'da' | 'en'", "persona: string"],
        response: "ReadableStream (text/event-stream)"
      },
      {
        path: "/api/guestbook",
        method: "GET / POST",
        description: "Håndterer læsning og afsendelse af hilsner i gæstebogen.",
        params: ["name: string", "message: string", "avatar?: string"],
        response: "JSON { success: boolean, entries?: Entry[] }"
      },
      {
        path: "/api/now",
        method: "GET",
        description: "Returnerer min nuværende status og aktive aktivitet (emoji + tekst).",
        params: [],
        response: "JSON { status: string, emoji: string }"
      }
    ]
  },
  en: {
    title: "API Documentation | Anton Meier Ebsen Jørgensen",
    description: "Documentation for public and internal API endpoints on antonebsen.dk.",
    heroTitle: "The Protocol",
    heroText: "Welcome to the developer portal. Here you'll find specifications for the endpoints powering my interactive systems.",
    endpoints: [
      {
        path: "/api/chat",
        method: "POST",
        description: "Interface to the AI Concierge with streaming support.",
        params: ["message: string", "lang: 'da' | 'en'", "persona: string"],
        response: "ReadableStream (text/event-stream)"
      },
      {
        path: "/api/guestbook",
        method: "GET / POST",
        description: "Handles reading and posting messages to the guestbook.",
        params: ["name: string", "message: string", "avatar?: string"],
        response: "JSON { success: boolean, entries?: Entry[] }"
      },
      {
        path: "/api/now",
        method: "GET",
        description: "Returns my current live status and active activity (emoji + text).",
        params: [],
        response: "JSON { status: string, emoji: string }"
      }
    ]
  }
};

const t = isDa ? content.da : content.en;
---

<Layout title={t.title} description={t.description}>
  <main class="container mx-auto px-4 py-20">
    <Section class="mb-20 animate-on-scroll">
      <div class="max-w-3xl">
        <p class="text-[10px] font-mono font-bold text-accent uppercase tracking-[0.3em] mb-4">Discovery Service v1.0</p>
        <h1 class="text-6xl font-black mb-8 tracking-tight bg-gradient-to-br from-white to-white/40 bg-clip-text text-transparent italic">
          {t.heroTitle}
        </h1>
        <p class="text-xl text-dim border-l border-accent/20 pl-6 leading-relaxed">
          {t.heroText}
        </p>
      </div>
    </Section>

    <div class="grid grid-cols-1 gap-12">
      {t.endpoints.map((ep, idx) => (
        <Section class={`animate-on-scroll delay-${(idx + 1) * 100}`}>
          <Card variant="bordered" class="p-0 overflow-hidden group">
            <div class="flex flex-col md:flex-row">
              <!-- Method/Path Sidebar -->
              <div class="w-full md:w-64 bg-white/[0.03] p-8 border-b md:border-b-0 md:border-r border-white/5">
                <span class={`inline-block px-2 py-0.5 rounded text-[10px] font-bold mb-3 ${ep.method.includes('POST') ? 'bg-blue-500/20 text-blue-400' : 'bg-green-500/20 text-green-400'}`}>
                  {ep.method}
                </span>
                <h3 class="font-mono text-sm text-white font-bold break-all">{ep.path}</h3>
              </div>
              
              <!-- Content -->
              <div class="flex-1 p-8">
                <p class="text-dim text-sm mb-6 leading-relaxed">
                  {ep.description}
                </p>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
                  <div>
                    <h4 class="text-[10px] font-bold uppercase tracking-widest text-accent mb-3">Parameters</h4>
                    <ul class="space-y-2">
                       {ep.params.length > 0 ? ep.params.map(p => (
                         <li class="font-mono text-[11px] text-white/60 bg-white/5 px-2 py-1 rounded">
                            {p}
                         </li>
                       )) : <li class="text-[11px] text-white/30 italic">No parameters required</li>}
                    </ul>
                  </div>
                  <div>
                    <h4 class="text-[10px] font-bold uppercase tracking-widest text-accent mb-3">Response</h4>
                    <code class="text-[11px] text-white/60 bg-white/5 px-2 py-1 rounded block">
                      {ep.response}
                    </code>
                  </div>
                </div>
              </div>
            </div>
          </Card>
        </Section>
      ))}
    </div>

    <!-- Quick Start -->
    <Section class="mt-20 animate-on-scroll">
       <Card variant="glass" class="p-10 border-accent/20 bg-accent/[0.02]">
          <h2 class="text-2xl font-bold mb-6 italic">Quick Start</h2>
          <pre class="bg-black/40 p-6 rounded-xl border border-white/5 overflow-x-auto"><code class="text-xs text-blue-300">curl -X GET https://antonebsen.dk/api/now \
  -H "Accept: application/json"</code></pre>
       </Card>
    </Section>
  </main>
</Layout>
