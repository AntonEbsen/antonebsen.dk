---
import Layout from '@layouts/BaseLayout.astro';
import Button from '@components/ui/Button.astro';
import Section from '@components/ui/Section.astro';
import Card from '@components/ui/Card.astro';
import SectionHeading from '@components/ui/SectionHeading.astro';
import ContactCard from '@components/common/ContactCard.astro';

interface Props {
  lang: 'da' | 'en' | 'de';
}

const { lang } = Astro.props;
const isDa = lang === 'da';

const t = {
  da: {
    title: "Anton Meier Ebsen Jørgensen – Blog",
    desc: "Blog med indlæg om faglige emner, træning og rejser.",
    heroTitle: "Indlæg og noter",
    heroText: "Fokus på <strong>Økonomi</strong>, <strong>Data</strong> og <strong>AI</strong>. Her deler jeg analyser, tanker og eksperimenter.",
    latestBtn: "Seneste nyt",
    bucketBtn: "Bucket List",
    statusPre: "Viser",
    statusPost: "indlæg.",
    statusEmpty: "Ingen indlæg endnu.",
    featuredTitle: "Udvalgte indlæg & ressourcer",
    featuredText: "Her er nogle af de ting, jeg har brugt mest tid på at skrive eller bygge.",
    featuredText: "Her er nogle af de ting, jeg har brugt mest tid på at skrive eller bygge.",
    readMore: "Læs mere",
    noPosts: "Ingen indlæg fundet. Tjek din database.",
    ctaTitle: "Forslag til indlæg?",
    ctaText: "Hvis du har et emne, jeg burde skrive om, så lad mig det vide.",
    readingTime: "min læsning",
    featured: [

      {
        title: "Mine Favoritpodcasts",
        tag: "Inspiration",
        meta: "Makro · Data · Humor",
        desc: "En oversigt over de bedste kilder til viden og underholdning on-the-go.",
        link: "/podcasts",
        linkText: "Se liste"
      }
    ]
  },
  en: {
    title: "Anton Meier Ebsen Jørgensen – Blog",
    desc: "Blog with posts about professional topics, training, and travel.",
    heroTitle: "Posts and Notes",
    heroText: "Focus on <strong>Economics</strong>, <strong>Data</strong>, and <strong>AI</strong>. Sharing analysis, thoughts, and experiments.",
    latestBtn: "Latest News",
    bucketBtn: "Bucket List",
    statusPre: "Showing",
    statusPost: "posts.",
    statusEmpty: "No posts yet.",
    featuredTitle: "Featured Posts & Resources",
    featuredText: "Here are some of the things I have spent most time writing or building.",
    featuredText: "Here are some of the things I have spent most time writing or building.",
    readMore: "Read more",
    noPosts: "No posts found. Check your database.",
    ctaTitle: "Suggestions for posts?",
    ctaText: "If you have a topic I should write about, let me know.",
    readingTime: "min read",
    featured: [

      {
        title: "My Favorite Podcasts",
        tag: "Inspiration",
        meta: "Macro · Data · Humor",
        desc: "An overview of the best sources for knowledge and entertainment on-the-go.",
        link: "/en/podcasts",
        linkText: "View List"
      }
    ]
  },
  de: {
    title: "Anton Meier Ebsen Jørgensen – Blog",
    desc: "Blog mit Beiträgen über berufliche Themen, Training und Reisen.",
    heroTitle: "Beiträge und Notizen",
    heroText: "Fokus auf <strong>Ökonomie</strong>, <strong>Daten</strong> und <strong>KI</strong>. Analysen, Gedanken und Experimente.",
    latestBtn: "Aktuelles",
    bucketBtn: "Bucket List",
    statusPre: "Zeige",
    statusPost: "Beiträge.",
    statusEmpty: "Noch keine Beiträge.",
    featuredTitle: "Hervorgehobene Beiträge & Ressourcen",
    featuredText: "Hier sind einige der Dinge, an denen ich am meisten gearbeitet oder die ich geschrieben habe.",
    featuredText: "Hier sind einige der Dinge, an denen ich am meisten gearbeitet oder die ich geschrieben habe.",
    readMore: "Weiterlesen",
    noPosts: "Keine Beiträge gefunden. Überprüfen Sie Ihre Datenbank.",
    ctaTitle: "Vorschläge für Beiträge?",
    ctaText: "Wenn Sie ein Thema haben, über das ich schreiben sollte, lassen Sie es mich bitte wissen.",
    featured: [

      {
        title: "Meine Lieblings-Podcasts",
        tag: "Inspiration",
        meta: "Makro · Daten · Humor",
        desc: "Eine Übersicht der besten Quellen für Wissen und Unterhaltung unterwegs.",
        link: "/de/podcasts",
        linkText: "Liste ansehen"
      }
    ]
  }
};

const content = (t as any)[lang] || t.da;

// Data Fetching (SSR)
// Data Fetching (SSR)
import BlogCard from '@components/blog/BlogCard.astro';
import { getCollection } from 'astro:content';

// Fetch Local Content
const localPosts = await getCollection('blog');

// Normalize Local Posts to match display format
const formattedLocalPosts = localPosts.map(p => ({
  title: p.data.title,
  category: p.data.category,
  created_at: new Date().toISOString(), // Or add date to frontmatter
  excerpt: p.data.description,
  slug: p.id,
  isLocal: true
}));

const posts = formattedLocalPosts; 
// Note: Supabase fetching removed for now to prioritize local "Platinum" content.
// If valid archives exist in Supabase, we could merge them here.
---

<Layout 
  title={content.title}
  description={content.desc}
  bodyClass="blog-page"
>

  <style>
    .blog-wrap { 
      max-width: 1200px; 
      margin: 24px auto; 
      padding: 0 16px 32px; 
    }

    .hero-grid {
      display: grid; 
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1fr);
      gap: 22px; 
      align-items: start; 
    }

    .posts-grid {
      display: grid; 
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px; 
      margin-top: 14px;
    }

    @media (max-width: 980px) {
      .hero-grid { 
        grid-template-columns: 1fr; 
      }
      .posts-grid { 
        grid-template-columns: 1fr; 
      }
    }
  </style>

  <main class="blog-wrap">

    <!-- HERO -->
    <Section>
      <div class="hero-grid">
        <Card variant="glass" class="p-8">
          <p class="text-xs font-extrabold uppercase tracking-widest text-dim mb-3">Blog</p>
          <h1 class="text-4xl leading-[1.15] mb-5 font-bold">{content.heroTitle}</h1>
          <p class="text-[17px] leading-relaxed text-dim mb-6 opacity-90" set:html={content.heroText} />
  
          <div class="flex flex-wrap gap-3 mb-6">
            <Button href="#latest">{content.latestBtn}</Button>
          </div>
        </Card>
  
        <div class="hidden md:block">
          <Card variant="glass" class="p-6">
            <SectionHeading>Status</SectionHeading>
            <p class="text-dim opacity-80 m-0">
              {posts.length > 0 ? `${content.statusPre} ${posts.length} ${content.statusPost}` : content.statusEmpty}
            </p>
          </Card>
        </div>
      </div>
    </Section>

    <!-- ===================== -->
    <!-- FEATURED POSTS -->
    <!-- ===================== -->
    <Section id="featured">
      <SectionHeading class="mb-4 text-xl font-bold">{content.featuredTitle}</SectionHeading>
      <div class="posts-grid mb-12">
        {content.featured.map(feat => (
            <BlogCard 
              title={feat.title}
              tag={feat.tag}
              meta={feat.meta}
              description={feat.desc}
              links={[{ label: feat.linkText, url: feat.link, icon: 'arrow-right' }]}
            />
        ))}
      </div>
    </Section>

    <!-- CTA -->
    <Section>
      <ContactCard 
        variant="glass" 
        title={content.ctaTitle}
        text={content.ctaText}
        action="contact"
      />
    </Section>

  </main>
</Layout>



